import{_ as a,c as n,o as e,U as i,k as s,a as l}from"./chunks/framework.aGaNZw_P.js";const t="/assets/application.GpEmJx00.jpg",p="/assets/compose_step_1.lO7eya59.jpg",r="/assets/compose_step_2.M1QcZpkM.jpg",h="/assets/compose_step_3.DbeTV-GL.jpg",o="/assets/analyse_code.C0e16R8C.jpg",k="/assets/app_avec_structure.pVx8NlTa.jpg",d="/assets/package_1.CHwPvGL0.jpg",c="/assets/package_2.Bzo2VBML.jpg",u="/assets/create_composant_file.aH3J-fji.jpg",E="/assets/create_composant_file_2.DbpE9sEB.jpg",m="/assets/card_component.rRHL5_NK.jpg",g="/assets/liste_preview.Bk1E8u_a.jpg",b="/assets/create_package.LKcxYQA2.jpg",y="/assets/parameters.DofcIhnA.jpg",F="/assets/animation.BaiIkWKa.jpg",v="/assets/lifecycle-composition.RZ-dsXoZ.png",C="/assets/arborescence_ble.CQ39TQAj.jpg",f="/assets/manifest_approot.Cf1Q7AF6.jpg",A="/assets/animation_bar.COEZLq_s.gif",U=JSON.parse(`{"title":"Introduction √† Android Compose","description":"Dans ce TP nous allons mettre en pratique l'√©criture de composants avec Android Compose. De la logique √† la r√©alisation, nous allons parcourir les bases de la r√©alisation de composants et de ¬´ la r√©activit√© ¬ª en lien avec ceux-ci.","frontmatter":{"description":"Dans ce TP nous allons mettre en pratique l'√©criture de composants avec Android Compose. De la logique √† la r√©alisation, nous allons parcourir les bases de la r√©alisation de composants et de ¬´ la r√©activit√© ¬ª en lien avec ceux-ci."},"headers":[],"relativePath":"tp/composants/android.md","filePath":"tp/composants/android.md","lastUpdated":1703687304000}`),q={name:"tp/composants/android.md"},B=i('<h1 id="introduction-a-android-compose" tabindex="-1">Introduction √† Android Compose <a class="header-anchor" href="#introduction-a-android-compose" aria-label="Permalink to &quot;Introduction √† Android Compose&quot;">‚Äã</a></h1><details class="details custom-block"><summary>Sommaire</summary><nav class="table-of-contents"><ul><li><a href="#introduction">Introduction</a></li><li><a href="#apercu-du-projet">Aper√ßu du projet</a></li><li><a href="#creation-du-projet">Cr√©ation du projet</a></li><li><a href="#un-premier-lancement">Un premier lancement</a></li><li><a href="#la-structure-les-composants">La structure / Les composants</a></li><li><a href="#le-modifier">Le modifier</a></li><li><a href="#material-design">Material Design</a></li><li><a href="#un-peu-de-structure">Un peu de structure !</a></li><li><a href="#votre-premier-composant">Votre premier composant</a><ul><li><a href="#le-code-de-votre-composant">Le code de votre composant</a></li></ul></li><li><a href="#utiliser-votre-premier-composant">Utiliser votre premier composant</a><ul><li><a href="#rendre-votre-liste-interactive">Rendre votre liste interactive</a></li><li><a href="#gestion-du-bouton-retour">Gestion du bouton retour</a></li></ul></li><li><a href="#utiliser-toute-la-puissance-des-composants">Utiliser toute la puissance des composants</a></li><li><a href="#decouper-encore-plus">D√©couper encore plus</a></li><li><a href="#ajouter-des-animations">Ajouter des animations</a><ul><li><a href="#aller-plus-loin-avec-les-animations">Aller plus loin avec les animations</a></li></ul></li><li><a href="#utiliser-les-ressources-textes">Utiliser les ressources textes</a></li><li><a href="#naviguer-entre-differents-composants">Naviguer entre diff√©rents composants</a><ul><li><a href="#exemple-de-code-pour-nos-deux-composants-et-de-leur-utilisation">Exemple de code pour nos deux composants et de leur utilisation</a></li></ul></li><li><a href="#les-permissions">Les permissions</a><ul><li><a href="#ajouter-la-librairie">Ajouter la librairie</a></li><li><a href="#le-fichier-androidmanifest-xml">Le fichier AndroidManifest.xml</a></li><li><a href="#utiliser-la-librairie">Utiliser la librairie</a></li></ul></li><li><a href="#scannez-les-peripheriques-ble">Scannez les p√©riph√©riques BLE</a><ul><li><a href="#introduction-1">Introduction</a></li><li><a href="#le-context">Le Context</a></li><li><a href="#la-recomposition">La recomposition</a></li><li><a href="#le-viewmodel">Le ViewModel</a></li><li><a href="#evolution-de-la-structure">√âvolution de la structure</a></li><li><a href="#quelques-libraires-a-ajouter">Quelques libraires √† ajouter</a></li><li><a href="#le-code-du-scanscreen">Le code du ScanScreen</a></li><li><a href="#le-code-du-scanviewmodel">Le code du ScanViewModel</a></li><li><a href="#le-code-de-l-applicationroot">Le code de l&#39;ApplicationRoot</a></li><li><a href="#le-fichier-androidmanifest-xml-1">Le fichier AndroidManifest.xml</a></li><li><a href="#c-est-a-vous">C&#39;est √† vous</a></li></ul></li><li><a href="#arretons-nous-un-instant">Arr√™tons-nous un instant</a></li><li><a href="#aller-plus-loin-dans-la-navigation">Aller plus loin dans la navigation</a></li><li><a href="#bonus-adapter-la-topappbar">Bonus : Adapter la TopAppBar</a></li><li><a href="#le-code-complet">Le code complet</a></li></ul></nav></details><h2 id="introduction" tabindex="-1">Introduction <a class="header-anchor" href="#introduction" aria-label="Permalink to &quot;Introduction&quot;">‚Äã</a></h2><p>Dans ce TP nous allons mettre en pratique l&#39;√©criture de composants avec Android Compose. De la logique √† la r√©alisation, nous allons parcourir les bases de la r√©alisation de composants et de ¬´ la r√©activit√© ¬ª en lien avec ceux-ci.</p><p>Ce TP fait suite au cours sur Android Compose, je vous invite donc √† le lire avant de commencer ce TP (<a href="/cours/android_compose.html">Cours Android Compose</a>).</p><h2 id="apercu-du-projet" tabindex="-1">Aper√ßu du projet <a class="header-anchor" href="#apercu-du-projet" aria-label="Permalink to &quot;Aper√ßu du projet&quot;">‚Äã</a></h2><p>L&#39;application que nous allons r√©aliser ici est tr√®s simple. Il s&#39;agit juste d&#39;une liste et d&#39;une vue de d√©tail. Elle nous servira √† comprendre le syst√®me de composant.</p><p><img src="'+t+'" alt="Application" loading="lazy"></p><h2 id="creation-du-projet" tabindex="-1">Cr√©ation du projet <a class="header-anchor" href="#creation-du-projet" aria-label="Permalink to &quot;Cr√©ation du projet&quot;">‚Äã</a></h2><p>Pour la cr√©ation du projet, rien de sp√©cial √† pr√©voir. Il s&#39;agit ici de suivre le processus de cr√©ation d&#39;une application comme habituellement. Pour √ßa nous allons utiliser ¬´ Android Studio ¬ª qui est l&#39;IDE √† utiliser pour cr√©er une application Android.</p><p>Lors de la cr√©ation, Android Studio va nous poser plusieurs questions, nous allons donc choisir :</p><ul><li>Template : Empty <strong>Compose</strong> Activity</li><li>Language : Kotlin</li><li>SDK Min. : SDK 26. (ou plus)</li></ul><p>Je vous laisse suivre les √©tapes de cr√©ation d&#39;un nouveau projet.</p><p><img src="'+p+'" alt="Cr√©ation d&#39;un projet √âtape 1" loading="lazy"><img src="'+r+'" alt="Cr√©ation d&#39;un projet √âtape 2" loading="lazy"></p><div class="warning custom-block"><p class="custom-block-title">Mais quelques petites remarques :</p><ul><li>Le choix du package est tr√®s important. Comme nous avons vu ensemble en cours, le ¬´ Package ¬ª doit √™tre unique. En effet deux applications ne peuvent pas avoir le m√™me.</li><li>Choisir un min SDK qui correspond aux cibles des mobiles souhait√©s. (Si vous √™tes en France ou dans un autre pays, il conviendra de faire le bon choix).</li><li>Kotlin est maintenant le langage √† choisir, Java et Kotlin cohabite sans probl√®me vous n&#39;aurez donc aucun probl√®me de compatibilit√©.</li></ul></div><h2 id="un-premier-lancement" tabindex="-1">Un premier lancement <a class="header-anchor" href="#un-premier-lancement" aria-label="Permalink to &quot;Un premier lancement&quot;">‚Äã</a></h2><p>Pour d√©buter (et avant de tout casser), je vous laisse compiler et lancer une premi√®re fois l&#39;application propos√©e par Google. Le premier r√©sultat va √™tre incroyable, accrochez-vous‚Ä¶</p><p><img src="'+h+'" alt="Premi√®re application" loading="lazy"></p><blockquote><p>Dans mon cas l&#39;application est sur la droite.</p></blockquote><div class="tip custom-block"><p class="custom-block-title">STOP ! Analysons ensemble ce que nous avons obtenu.</p><p><img src="'+o+`" alt="Analyse code source" loading="lazy"></p><p>Nous allons donc retravailler tout √ßa pour organiser un minimum notre code source.</p></div><h2 id="la-structure-les-composants" tabindex="-1">La structure / Les composants <a class="header-anchor" href="#la-structure-les-composants" aria-label="Permalink to &quot;La structure / Les composants&quot;">‚Äã</a></h2><p>Compose repose sur l&#39;utilisation du code pour d√©finir l&#39;interface que l&#39;utilisateur va voir. Elle reprend les principes de la programmation en composant qui est largement utilis√©e dans le d√©veloppement web.</p><p>Nous avons √† notre disposition un ensemble de composants ¬´ fonctionnels ¬ª qui vont nous permettre de cr√©er les √©l√©ments de notre interface :</p><ul><li><code>Text</code> : Un composant qui permet d&#39;afficher du texte.</li><li><code>Button</code> : Un composant qui permet d&#39;afficher un bouton.</li><li><code>Switch</code> : Un composant qui permet d&#39;afficher un toggle (un bouton qui peut √™tre activ√© ou d√©sactiv√©).</li><li><code>Image</code> : Un composant qui permet d&#39;afficher une image.</li><li><code>LazyColumn</code> : Un composant qui permet d&#39;afficher une liste.</li><li><code>Scaffold</code> : Un composant qui permet de cr√©er une structure de base pour notre application (barre de navigation, etc.).</li><li><code>TopAppBar</code> : Un composant qui permet de cr√©er une barre de navigation en haut de l&#39;application.</li><li><code>Card</code> : Un composant qui permet de cr√©er une carte.</li><li><code>IconButton</code> : Un composant qui permet de cr√©er un bouton avec une ic√¥ne.</li><li>Etc‚Ä¶ (Il y en a beaucoup plus, mais nous allons nous arr√™ter l√† pour l&#39;instant).</li></ul><p>Nous avons √©galement des composants qui sont l√† pour d√©finir la structure de notre application :</p><ul><li><code>Column</code> : Un composant qui permet de cr√©er une colonne.</li><li><code>Row</code> : Un composant qui permet de cr√©er une ligne.</li><li><code>Box</code> : Un composant qui permet de cr√©er une bo√Æte.</li><li><code>Spacer</code> : Un composant qui permet de cr√©er un espace entre deux √©l√©ments.</li></ul><p>Les composants sont des fonctions que nous allons pouvoir appeler dans notre code. Ils seront appel√©s au bon moment en fonction de conditions que nous allons d√©finir. Les composants seront imbriquables les uns dans les autres, ce qui nous permettra de cr√©er des interfaces complexe. Par exemple :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Column</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Texte 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Texte 2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Texte 3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Ce code va nous permettre d&#39;afficher trois textes les uns en dessous des autres. Et si nous souhaitons afficher les textes les uns √† c√¥t√© des autres ? Il suffit de changer le composant <code>Column</code> par <code>Row</code>.</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Row</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Texte 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Texte 2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Texte 3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Nous pouvons √©galement imbriquer les Colonnes et les Lignes :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Column</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Row</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Texte 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Texte 2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Texte 3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Row</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Texte 4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Texte 5&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Texte 6&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Cet exemple est l√† pour vous montrer la puissance de Compose. Compose a √©t√© pens√© pour √™tre simple et modulaire, par exemple pour un bouton le principe est le m√™me :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(onClick </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* Code appel√© lors du clique sur le bouton */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Mon bouton&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Ici nous voyons que le composant <code>Button</code> prend en param√®tre une action (un code qui sera appel√© lors du clique sur le bouton) et un composant <code>Text</code> qui sera affich√© dans le bouton. Pratique ! Et si nous souhaitons un bouton avec un loader ? Et bien c&#39;est simple il suffit de changer le composant <code>Text</code> par un composant <code>CircularProgressIndicator</code> (qui est un loader).</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(onClick </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* Code appel√© lors du clique sur le bouton */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    CircularProgressIndicator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Et √©videmment, nous allons pouvoir cr√©er nos propres composants‚Ä¶</p><h2 id="le-modifier" tabindex="-1">Le modifier <a class="header-anchor" href="#le-modifier" aria-label="Permalink to &quot;Le modifier&quot;">‚Äã</a></h2><p>Le modifier est un √©l√©ment qui va nous permettre de modifier un composant. Par exemple, nous pouvons modifier la taille d&#39;un composant, sa couleur, etc. Pour √ßa nous allons utiliser le composant <code>Modifier</code> qui va nous permettre de modifier un composant.</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Mon texte&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, modifier </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Modifier.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dp))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Le modifier est diff√©rent d&#39;un composant √† un autre, il faut donc regarder la documentation pour savoir ce que l&#39;on peut faire avec un composant.</p><p>Par exemple, pour la colonne nous avons :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Column</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    modifier </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Modifier</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fillMaxWidth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">padding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dp)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Contenu de la colonne</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><code>fillMaxWidth</code> permet de remplir la largeur de la zone disponible.</li><li><code>padding</code> permet d&#39;ajouter un padding (un espace) autour de la colonne.</li></ul><div class="tip custom-block"><p class="custom-block-title">Rien de mieux que la documentation</p><p>Nous avons vu quelques composants, et quelques modifiers. Mais il y en a beaucoup plus. Je vous laisse regarder la documentation pour en savoir plus.</p><p><a href="https://developer.android.com/jetpack/compose/components" target="_blank" rel="noreferrer">Documentation</a></p><p>‚ö†Ô∏è Compose √©volue tr√®s rapidement, il est donc primordial de regarder la documentation‚Ä¶</p></div><h2 id="material-design" tabindex="-1">Material Design <a class="header-anchor" href="#material-design" aria-label="Permalink to &quot;Material Design&quot;">‚Äã</a></h2><p>En plus des composants propos√©s par Compose, nous avons √©galement acc√®s aux composants de Material Design. Le projet que vous avez cr√©√© utilise d√©j√† le Material Design en version 3.</p><p>Les composants propos√©s sont pr√™ts √† l&#39;emploi, ils int√®grent toutes les bonnes pratiques d√©finies par Google.</p><p><a href="https://m3.material.io/" target="_blank" rel="noreferrer">Documentation de Material Design</a></p><p>Ce TP est guid√©, vous n&#39;avez pas √† ¬´ apprendre la documentation ¬ª, par contre je vous invite √† la parcourir pour voir les options / fonctionnements, votre compr√©hension en sera grandement facilit√©e.</p><h2 id="un-peu-de-structure" tabindex="-1">Un peu de structure ! <a class="header-anchor" href="#un-peu-de-structure" aria-label="Permalink to &quot;Un peu de structure !&quot;">‚Äã</a></h2><p>Avant d&#39;aller plus loin, nous allons ajouter un peu de structure dans le microprojet. L&#39;id√©e √©tant de faire une application qui ressemble √† quelque chose. Nous allons ajouter la structure d&#39;une application basique √† savoir une <code>TopAppBar</code>.</p><p><img src="`+k+`" alt="TopAppBar" loading="lazy"></p><p>Je vous laisse modifier le code de la m√©thode <code>onCreate</code>, pour y mettre :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setContent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    MyApplicationTheme</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        Scaffold</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            topBar </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TopAppBar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(title </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Top App Bar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)}  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            Greeting</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Valentin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">L&#39;importance de la s√©mantique</p><p>Il est important d&#39;utiliser les bons termes. En d√©veloppement mobile, nous avons une terminologie qu&#39;il faut respecter. Ici la barre en haut ne se nomme pas ¬´ la barre en haut ¬ª, mais une AppBar.</p></div><p><em>√Ä faire :</em></p><p>Je vous laisse tester votre application √† nouveau.</p><div class="tip custom-block"><p class="custom-block-title">Un peu de couleur</p><p>Votre top-bar est blanche ? C&#39;est normal, nous n&#39;avons pas encore ajout√© de th√®me. Je vous laisse ajouter le th√®me suivant :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">topBar </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    TopAppBar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        title </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Top App Bar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) }, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Titre de la barre</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        colors </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TopAppBarDefaults.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">smallTopAppBarColors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            containerColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MaterialTheme.colorScheme.primaryContainer,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            titleContentColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MaterialTheme.colorScheme.primary,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ), </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Couleur de la barre</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div><h2 id="votre-premier-composant" tabindex="-1">Votre premier composant <a class="header-anchor" href="#votre-premier-composant" aria-label="Permalink to &quot;Votre premier composant&quot;">‚Äã</a></h2><p>Avant de r√©aliser le code, nous allons dans un premier temps cr√©er un nouveau package. Il nous servira √† stocker nos composants.</p><p>Cr√©ation du package, la proc√©dure est int√©gr√©e dans Android Studio : <img src="`+d+'" alt="Cr√©ation package" loading="lazy"></p><p>Nommage du package, dans mon cas ¬´ composants ¬ª : <img src="'+c+'" alt="Nommage" loading="lazy"></p><p>Maintenant que votre package est cr√©√©, je vous laisse cr√©er le fichier Kotlin qui contiendra votre code :</p><p><img src="'+u+'" alt="Cr√©ation fichier composant" loading="lazy"><img src="'+E+'" alt="Cr√©ation fichier composant suite" loading="lazy"></p><p>Pour le nom du fichier, je vous laisse choisir. Moi dans mon cas je vais le nommer ¬´ <code>composant_list_item.kt</code> ¬ª.</p>',66),D=s("div",{class:"tip custom-block"},[s("p",{class:"custom-block-title"},"Un instant !"),s("p",null,"Pas de classe !?"),s("iframe",{src:"https://giphy.com/embed/l0HlKrB02QY0f1mbm",width:"480",height:"270",frameBorder:"0",class:"giphy-embed",allowFullScreen:""}),s("p",null,[s("strong",null,"Et non"),l(" avec Compose, les composants ne sont pas des classes. Ce sont des fonctions ¬´ Composable ¬ª qui seront appel√©es au bon moment suivant les bonnes conditions dans votre vue.")])],-1),x=i(`<h3 id="le-code-de-votre-composant" tabindex="-1">Le code de votre composant <a class="header-anchor" href="#le-code-de-votre-composant" aria-label="Permalink to &quot;Le code de votre composant&quot;">‚Äã</a></h3><p>L&#39;id√©e ici est de vous faire constater le bon fonctionnement. Voil√† le code de votre premier composant :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> androidx.compose.foundation.Image</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> androidx.compose.foundation.layout.Column</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> androidx.compose.foundation.layout.Row</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> androidx.compose.foundation.layout.height</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> androidx.compose.foundation.layout.padding</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> androidx.compose.material.Card</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> androidx.compose.material.ExperimentalMaterialApi</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> androidx.compose.material.Text</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> androidx.compose.runtime.Composable</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> androidx.compose.ui.Alignment</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> androidx.compose.ui.Modifier</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> androidx.compose.ui.res.painterResource</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> androidx.compose.ui.text.font.FontWeight</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> androidx.compose.ui.tooling.preview.Preview</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> androidx.compose.ui.unit.dp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> androidx.compose.ui.unit.sp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> com.example.testcomposant.R</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> com.example.testcomposant.ui.theme.MyApplicationTheme</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@OptIn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ExperimentalMaterialApi::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@Composable</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ElementList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    title: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Mon titre&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    content: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Mon contenu&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    image: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">? </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> R.drawable.ic_launcher_foreground,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    onClick: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Unit </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Card</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(modifier </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Modifier.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fillMaxWidth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">padding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dp), onClick </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> onClick) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        Row</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(modifier </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Modifier.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">padding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dp), verticalAlignment </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Alignment.CenterVertically) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            image?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                Image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(modifier </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Modifier.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dp), painter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> painterResource</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> it), contentDescription </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            Column</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> title)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content, fontWeight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FontWeight.Light, fontSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.sp)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@Preview</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(showBackground </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@Composable</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DefaultPreview</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    MyApplicationTheme</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        ElementList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>Arr√™tons-nous un instant, que constatez-vous dans le code que vous avez copi√©-coll√© sans trop r√©fl√©chir üëÄ‚Ä¶</p><ul><li><code>@Composable</code> au-dessus de la fonction, indique l&#39;emplacement d&#39;un composant.</li><li><code>@Preview(showBackground = true)</code> permet de r√©aliser une preview de votre composant sans la lancer sur un t√©l√©phone (pratique, testons).</li><li>Les variables (<code>title</code>, <code>content</code>, <code>image</code>, <code>onClick</code>) seront le moyen de customiser notre composant.</li></ul><p>Je vous laisse mettre en place le code. Et valider que celui-ci s&#39;affiche correctement dans la partie preview.</p><p><img src="`+m+`" alt="Preview composant" loading="lazy"></p><h2 id="utiliser-votre-premier-composant" tabindex="-1">Utiliser votre premier composant <a class="header-anchor" href="#utiliser-votre-premier-composant" aria-label="Permalink to &quot;Utiliser votre premier composant&quot;">‚Äã</a></h2><p>Nous avons r√©alis√© notre premier composant, nous allons maintenant utiliser le composant dans notre application.</p><p>Pour √ßa nous allons cr√©er une liste (<code>LazyColumn</code> √©tant l&#39;√©quivalent d&#39;un <code>RecyclerView</code>, mais en beaucoup plus simple) Celui-ci contiendra le composant que vous avez cr√©√©.</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> myData </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> listOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Card 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Card 2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Card 3&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Card 4&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Card 5&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Card 6&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Card 7&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Card 8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Card 9&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Card 10&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">LazyColumn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    items</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(myData) { item </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        ElementList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(title </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // Code appel√© lors du clique sur un √©l√©ment de la liste.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Je vous laisse mettre le code en question <strong>√† la place</strong> du <code>Greeting</code> dans le composant <code>Scaffold</code>.</p><p>Vous devez obtenir :</p><p><img src="`+g+`" alt="Vous allez obtenir" loading="lazy"></p><h3 id="rendre-votre-liste-interactive" tabindex="-1">Rendre votre liste interactive <a class="header-anchor" href="#rendre-votre-liste-interactive" aria-label="Permalink to &quot;Rendre votre liste interactive&quot;">‚Äã</a></h3><p>Maintenant que notre liste s&#39;affiche, nous allons la rendre interactive lors du touch / clique de l&#39;utilisateur sur un √©l√©ment de la liste. Nous allons avoir besoin de deux choses :</p><ul><li>Une variable qui permettra de connaitre quel √©l√©ment √† √©t√© cliqu√©.</li><li>Une condition (<code>if</code>) pour savoir si nous devons afficher la <code>LazyColumn</code> ou seulement un <code>ElementList</code>.</li></ul><p>Pour la variable, la d√©claration de celle-ci est un peu particuli√®re :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> selectedItem </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">by</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> remember</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mutableStateOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">?&gt;(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Ajouter cette ligne apr√®s votre variable <code>myData</code>.</p><div class="tip custom-block"><p class="custom-block-title">C&#39;est √† vous</p><p>Je vous laisse ajouter la condition pour :</p><ul><li>Afficher la <code>LazyColumn</code> ou <code>ElementList</code> en fonction de <code>selectedItem != null</code>.</li></ul></div><h3 id="gestion-du-bouton-retour" tabindex="-1">Gestion du bouton retour <a class="header-anchor" href="#gestion-du-bouton-retour" aria-label="Permalink to &quot;Gestion du bouton retour&quot;">‚Äã</a></h3><p>Si tout fonctionne comme pr√©vu, vous devez avoir la possibilit√© de s√©lectionner un √©l√©ment. Mais pour l&#39;instant pas moyen de revenir sur la liste enti√®re.</p><p>Pour √ßa nous allons ajouter un nouvel attribut dans notre <code>TopAppBar</code></p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">navigationIcon </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (selectedItem </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        IconButton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(onClick </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { selectedItem </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Icon</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Icons.Default.ArrowBack, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Back&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Cet attribut va ajouter un bouton retour si un √©l√©ment est s√©lectionn√©. Je vous laisse mettre en place √ßa dans votre code.</p><h2 id="utiliser-toute-la-puissance-des-composants" tabindex="-1">Utiliser toute la puissance des composants <a class="header-anchor" href="#utiliser-toute-la-puissance-des-composants" aria-label="Permalink to &quot;Utiliser toute la puissance des composants&quot;">‚Äã</a></h2><p>Vous l&#39;avez peut-√™tre remarqu√©, pour l&#39;instant notre liste est tr√®s simple. Vous avez d√©clar√© une liste de <code>string</code>, je vais vous demander d&#39;allez un peu plus loin. Vous allez cr√©er une liste <code>d&#39;objet</code> (plut√¥t que <code>string</code>).</p><p>√âvidemment, je vais vous demander d&#39;organiser tout √ßa.</p><ul><li>Cr√©er un package nomm√© models :</li></ul><p><img src="`+b+`" alt="Create Package" loading="lazy"></p><ul><li>Ajouter dans ce package une Classe (<code>data class</code> pour √™tre pr√©cis) :</li></ul><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CardContent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> title: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> content: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@DrawableRes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> image: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">?)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">Data class ?</p><p>√âtrange cette classe n&#39;est-ce pas ?</p><p>Nous cr√©ons fr√©quemment des classes dont le but principal est de conserver des donn√©es. Dans une telle classe, certaines fonctionnalit√©s standard et fonctions utilitaires sont souvent d√©rivables m√©caniquement √† partir des donn√©es. Dans Kotlin, cela s&#39;appelle une classe de donn√©es et est marqu√© comme <code>data</code>.</p></div><p>C&#39;est √† vous, je vous laisse modifier votre liste (nomm√© <code>myData</code>) par une liste de <code>CardContent</code> (la classe que vous avez cr√©√©e). Cette liste doit contenir 10 √©l√©ments avec des titres, des contenus et une image diff√©rente que celle par d√©faut (le logo de l&#39;√©cole par exemple).</p><details class="details custom-block"><summary>Besoin d&#39;aide ?</summary><p>Avez-vous cherch√© ? Si oui, voil√† un indice :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> myData </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> listOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CardContent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Card 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Contenu de la card 1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, R.drawable.logo), ‚Ä¶)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></details><h2 id="decouper-encore-plus" tabindex="-1">D√©couper encore plus <a class="header-anchor" href="#decouper-encore-plus" aria-label="Permalink to &quot;D√©couper encore plus&quot;">‚Äã</a></h2><p>Nous avons cr√©√© un composant, c&#39;est bien, mais nous pouvons faire bien plus. En reprenant la logique du composant <code>ElementList</code>, je vous laisse cr√©er un composant nomm√© <code>EseoTopAppBar</code> qui contiendra toute la logique de votre <code>TopAppBar</code> :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TopAppBar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    navigationIcon </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (selectedItem </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            IconButton</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(onClick </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { selectedItem </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Icon</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Icons.Default.ArrowBack, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Back&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    title </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Top App Bar&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Une fois ce composant cr√©√© (dans le bon dossier), je vous laisse l&#39;utilis√© directement dans votre <code>Scaffold</code>.</p><div class="tip custom-block"><p class="custom-block-title">Rappel</p><p><img src="`+y+`" alt="Param√®tres" loading="lazy"></p><p>Les √©l√©ments encadr√©s en rouge sont les param√®tres de chaque m√©thode. Certains sont des strings, d&#39;autres des actions, mais un param√®tre peut-√™tre un composant. C&#39;est le cas ici avec <code>topBar =</code>.</p></div><p>Je vous laisse tester que votre application fonctionne toujours.</p><h2 id="ajouter-des-animations" tabindex="-1">Ajouter des animations <a class="header-anchor" href="#ajouter-des-animations" aria-label="Permalink to &quot;Ajouter des animations&quot;">‚Äã</a></h2><p>Une liste c&#39;est bien ! Mais une liste avec des animations c&#39;est encore mieux !</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AnimatedContent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(label </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) (</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* Votre Condition OU votre √©tat */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ) { targetState </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    when</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (targetState) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        true</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* Composant affich√© quand la condition est vrai */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        false</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* Composant affich√© quand la condition est fausse */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Je vous laisse int√©grer ce code dans votre application afin d&#39;animer le changement d&#39;√©tat. Apr√®s int√©gration vous devriez obtenir :</p>`,46),S=s("iframe",{width:"560",height:"315",src:"https://www.youtube-nocookie.com/embed/LrYjOWEid2A?controls=0",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""},null,-1),_=i('<h3 id="aller-plus-loin-avec-les-animations" tabindex="-1">Aller plus loin avec les animations <a class="header-anchor" href="#aller-plus-loin-avec-les-animations" aria-label="Permalink to &quot;Aller plus loin avec les animations&quot;">‚Äã</a></h3><p><a href="https://storage.googleapis.com/android-stories/compose/Compose_Animation_Cheat_Sheet.pdf" target="_blank" rel="noreferrer"><img src="'+F+`" alt="Aide m√©moire" loading="lazy"></a></p><p><em>Source:</em> <a href="https://twitter.com/JorgeCastilloPr/status/1579057096360079361" target="_blank" rel="noreferrer">Twitter</a></p><h2 id="utiliser-les-ressources-textes" tabindex="-1">Utiliser les ressources textes <a class="header-anchor" href="#utiliser-les-ressources-textes" aria-label="Permalink to &quot;Utiliser les ressources textes&quot;">‚Äã</a></h2><p>Avoir des composants ne veut pas dire oublier les bonnes pratiques bien au contraire ! Pour finaliser votre application, je vous laisse sortir les diff√©rents textes dans le fichier. <code>strings.xml</code></p><p>Une fois vos textes externalis√©s, vous pouvez rendre visible via :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(R.string.id_de_votre_string_dans_le_xml)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Je vous laisse utiliser cette m√©thode aux diff√©rents endroits ou vous avez mis du texte ¬´ en dur ¬ª.</p><h2 id="naviguer-entre-differents-composants" tabindex="-1">Naviguer entre diff√©rents composants <a class="header-anchor" href="#naviguer-entre-differents-composants" aria-label="Permalink to &quot;Naviguer entre diff√©rents composants&quot;">‚Äã</a></h2><p>R√©aliser une interface avec Jetpack Compose c&#39;est un peu comme assembler des Lego. Vos composants sont vos briques et vous allez devoir les assembler pour cr√©er votre application.</p><p>Prenons les composants que nous avons cr√©√©s :</p><ul><li>Une liste d&#39;√©l√©ments.</li><li>Une card repr√©sentant un √©l√©ment.</li></ul><p>Finalement, nous avons li√© ces deux composants ensemble en utilisant un √©tat. Lors de la s√©lection d&#39;un √©l√©ment, nous avons chang√© l&#39;√©tat de notre application pour afficher la card de l&#39;√©l√©ment s√©lectionn√©.</p><p>C&#39;est un peu comme si nous avions une pi√®ce dans laquelle nous pouvions entrer et sortir. Pour entrer et sortir, nous utilisons l&#39;action onClick, le onClick nous permet de changer l&#39;√©tat de notre application.</p><p>Dans cet exemple, nous avons utilis√© un √©tat pour g√©rer l&#39;affichage de notre card. Mais nous pouvons aussi utiliser un √©tat pour g√©rer la s√©lection d&#39;un √©l√©ment :</p><p><strong>(C&#39;est un exemple, √† ne pas copier-coller)</strong></p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> selectedItem </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> remember</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mutableStateOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (selectedItem.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Nous n&#39;avons pas d&#39;√©l√©ment s√©lectionn√©, nous affichons donc la liste.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ElementList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(selectedItem)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Nous avons un √©l√©ment s√©lectionn√©, nous affichons donc la card.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ElementCard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(selectedItem.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">value!!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Prenons un autre exemple, dans un cas simple de deux composants d&#39;interface, nous pourrions √©crire quelque chose comme :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Column</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Modifier.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">padding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(it)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isLoggedIn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> remember</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mutableStateOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isLoggedIn.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        HomeScreen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        LoginScreen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // L&#39;action sera √©mise par le composant LoginScreen. Via un bouton par exemple.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            isLoggedIn.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Ici nous avons un √©tat qui nous permet de savoir si l&#39;utilisateur est connect√© ou non. Il faut donc comprendre que le code permet de :</p><ul><li>Si l&#39;utilisateur est connect√©, afficher l&#39;√©cran d&#39;accueil.</li><li>Si l&#39;utilisateur n&#39;est pas connect√©, afficher l&#39;√©cran de connexion.</li></ul><p>√âvidemment, il est possible de faire plus complexe, mais pour l&#39;instant nous allons nous concentrer sur ces deux exemples.</p><h3 id="exemple-de-code-pour-nos-deux-composants-et-de-leur-utilisation" tabindex="-1">Exemple de code pour nos deux composants et de leur utilisation <a class="header-anchor" href="#exemple-de-code-pour-nos-deux-composants-et-de-leur-utilisation" aria-label="Permalink to &quot;Exemple de code pour nos deux composants et de leur utilisation&quot;">‚Äã</a></h3><p>Les deux composants :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@Composable</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> HomeScreen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Bienvenue sur votre application&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // √Ä compl√©ter avec votre liste d&#39;√©l√©ments pr√©c√©demment cr√©√©e.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@Composable</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> LoginScreen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(onLogin: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Unit) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(onClick </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> onLogin) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Se connecter&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Un peu de d√©tail sur le composant LoginScreen :</p><ul><li><code>onLogin</code> est une action qui sera √©mise par le composant. Cette action sera √©mise lors du clique sur le bouton (par l&#39;utilisateur). C&#39;est ce que nous appelons un callback, il permet de faire remonter une action dans le composant parent.</li></ul><p>L&#39;utilisation de ces deux composants, dans un Scaffold :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@Composable</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyApp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Scaffold</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        topBar </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            TopAppBar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                title </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Mon application&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        Column</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Modifier.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">padding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(it)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isLoggedIn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> remember</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mutableStateOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isLoggedIn.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                HomeScreen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                LoginScreen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    isLoggedIn.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>Je vous laisse tester le code. √âvidemment, dans le composant <code>HomeScreen</code> je vous laisse remettre votre liste d&#39;√©l√©ments (que vous avez cr√©√©e pr√©c√©demment).</p><p>Votre fichier <code>MainActivity.kt</code> doit ressembler √† √ßa :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MainActivity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ComponentActivity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    override</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onCreate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(savedInstanceState: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Bundle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">?) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onCreate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(savedInstanceState)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        setContent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            MyApplicationTheme</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                MyApp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Vous commencez √† comprendre le fonctionnement ? Nous avons un composant <code>MyApp</code> qui contient un <code>Scaffold</code> qui contient un <code>Column</code> qui contient un √©tat qui permet de savoir si l&#39;utilisateur est connect√© ou non. En fonction de cet √©tat, nous affichons un composant ou un autre.</p><p>√áa semble compliqu√© ? C&#39;est en effet un peu diff√©rent de ce que vous avez l&#39;habitude de faire. Mais c&#39;est tr√®s puissant, car vous pouvez cr√©er des composants qui sont r√©utilisables et qui peuvent √™tre utilis√©s dans plusieurs endroits de votre application.</p><p>On d√©coupe notre code en plein de petits morceaux, et on assemble le tout pour cr√©er notre application.</p><h2 id="les-permissions" tabindex="-1">Les permissions <a class="header-anchor" href="#les-permissions" aria-label="Permalink to &quot;Les permissions&quot;">‚Äã</a></h2><p>Nous avons vu dans notre introduction Android que nous avions besoin de demander des permissions √† l&#39;utilisateur pour acc√©der √† certaines fonctionnalit√©s de son t√©l√©phone. Nous allons voir comment faire avec Compose. Pour √ßa nous allons devoir utiliser une librairie d√©velopp√©e par Google : <a href="https://google.github.io/accompanist/" target="_blank" rel="noreferrer">Accompanist</a></p><div class="tip custom-block"><p class="custom-block-title">Accompanist</p><p>Accompanist est une librairie de transition, elle existe le temps que Compose √©volue, m√ªrisse et que les fonctionnalit√©s soient int√©gr√©es dans Compose (ou pas, mais c&#39;est un autre d√©bat).</p></div><p>Pour rester dans le th√®me du Bluetooth, nous allons regarder comment demander les permissions en lien avec le BLE.</p><h3 id="ajouter-la-librairie" tabindex="-1">Ajouter la librairie <a class="header-anchor" href="#ajouter-la-librairie" aria-label="Permalink to &quot;Ajouter la librairie&quot;">‚Äã</a></h3><p>Pour ajouter la librairie, nous allons devoir modifier notre fichier <code>build.gradle</code> (celui dans <code>app</code> du projet). Nous allons ajouter la d√©pendance suivante :</p><div class="language-groovy vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    implementation(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;com.google.accompanist:accompanist-permissions:0.30.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Il faut ensuite synchroniser le projet avec les modifications (bandeau bleu en haut).</p><h3 id="le-fichier-androidmanifest-xml" tabindex="-1">Le fichier AndroidManifest.xml <a class="header-anchor" href="#le-fichier-androidmanifest-xml" aria-label="Permalink to &quot;Le fichier AndroidManifest.xml&quot;">‚Äã</a></h3><p>Avant de demander les permissions, nous allons devoir les d√©clarer pour que l&#39;application puisse les demander. Pour √ßa nous allons modifier le fichier <code>AndroidManifest.xml</code>. Nous allons ajouter les permissions suivantes :</p><div class="language-xml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&lt;!-- Permissions pour le BLE Android 12 et plus --&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses-permission</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> android:name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;android.permission.BLUETOOTH_SCAN&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    android:usesPermissionFlags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;neverForLocation&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    tools:targetApi</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;s&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses-permission</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> android:name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;android.permission.BLUETOOTH_CONNECT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&lt;!-- Ancienne permission pour permettre l&#39;usage du BLE  Android avant 11 inclus --&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses-permission</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> android:name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;android.permission.BLUETOOTH&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses-permission</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> android:name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;android.permission.BLUETOOTH_ADMIN&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses-permission</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> android:name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;android.permission.ACCESS_COARSE_LOCATION&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">uses-permission</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> android:name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;android.permission.ACCESS_FINE_LOCATION&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="utiliser-la-librairie" tabindex="-1">Utiliser la librairie <a class="header-anchor" href="#utiliser-la-librairie" aria-label="Permalink to &quot;Utiliser la librairie&quot;">‚Äã</a></h3><p>Cette librarie va nous permettre de demander les permissions √† l&#39;utilisateur et de g√©rer l&#39;√©tat de la demande (accept√©e, refus√©e, etc.). Si vous avez compris ce que nous avons vus pr√©c√©demment, vous vous doutez que tout va √™tre g√©r√© par un √©tat.</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> toCheckPermissions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Build.VERSION.SDK_INT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Build.VERSION_CODES.S) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    listOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(android.Manifest.permission.ACCESS_FINE_LOCATION)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    listOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(android.Manifest.permission.BLUETOOTH_CONNECT, android.Manifest.permission.BLUETOOTH_SCAN)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> permissionState </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> rememberMultiplePermissionsState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(toCheckPermissions)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Quelques explications :</p><ul><li><code>toCheckPermissions</code> est une liste de permissions √† v√©rifier. Dans notre cas, nous allons v√©rifier les permissions pour le Bluetooth. En fonction de la version d&#39;Android, nous n&#39;allons pas v√©rifier les m√™mes permissions. C&#39;est pour √ßa que nous avons une condition qui permet de v√©rifier la version d&#39;Android.</li><li><code>rememberMultiplePermissionsState</code> est un √©tat qui va contenir l&#39;√©tat de la demande de permission. Cet √©tat va nous permettre de savoir si les permissions sont accord√©s ou non.</li></ul><p>Maintenant que nous avons notre √©tat, nous allons pouvoir l&#39;utiliser pour demander les permissions √† l&#39;utilisateur. Pour √ßa nous allons utiliser un composant nomm√© <code>PermissionRequired</code> :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">permissionState.allPermissionsGranted) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(onClick </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { permissionState.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">launchMultiplePermissionRequest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() }) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Demander la permission&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Permission accord√©e&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Que fait ce code ?</p><ul><li>Si l&#39;utilisateur n&#39;a pas accord√© les permissions, nous affichons un bouton qui permet de demander les permissions.</li><li>Si l&#39;utilisateur a accord√© les permissions, nous affichons un texte qui indique que les permissions sont accord√©es.</li></ul><h2 id="scannez-les-peripheriques-ble" tabindex="-1">Scannez les p√©riph√©riques BLE <a class="header-anchor" href="#scannez-les-peripheriques-ble" aria-label="Permalink to &quot;Scannez les p√©riph√©riques BLE&quot;">‚Äã</a></h2><p>Sans entrer dans le d√©tails des subtilit√©s du Bluetooth, nous allons d√©composer le code permettant de scanner les p√©riph√©rique BLE. Voil√† le r√©sultat final :</p>`,57),L=s("iframe",{width:"560",height:"315",src:"https://www.youtube-nocookie.com/embed/WZessnr9gZ4?controls=0",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""},null,-1),w=i('<h3 id="introduction-1" tabindex="-1">Introduction <a class="header-anchor" href="#introduction-1" aria-label="Permalink to &quot;Introduction&quot;">‚Äã</a></h3><p>Pour scanner les p√©riph√©riques BLE, nous allons avoir besoin de plusieurs choses :</p><ul><li>Un √©tat qui va contenir la liste des p√©riph√©riques scann√©s.</li><li>Un √©tat qui va contenir l&#39;√©tat du scan (en cours, termin√©, etc.)</li><li>Le contexte de l&#39;application (pour acc√©der au Bluetooth).</li><li>L&#39;acc√®s au Bluetooth du t√©l√©phone.</li><li>Un d√©coupage de notre code en ViewModel.</li></ul><h3 id="le-context" tabindex="-1">Le <code>Context</code> <a class="header-anchor" href="#le-context" aria-label="Permalink to &quot;Le `Context`&quot;">‚Äã</a></h3><p>Pour rappel le <code>Context</code> est un objet qui permet d&#39;acc√©der √† des informations sur l&#39;application. Dans notre cas, nous allons avoir besoin du contexte pour acc√©der au Bluetooth du t√©l√©phone.</p><p>‚ö†Ô∏è C&#39;est un √©l√©ment obligatoire.</p><h3 id="la-recomposition" tabindex="-1">La recomposition <a class="header-anchor" href="#la-recomposition" aria-label="Permalink to &quot;La recomposition&quot;">‚Äã</a></h3><p>Il faut comprendre ici que notre vue sera ¬´ recompos√©e ¬ª √† chaque fois que nous allons obtenir de nouveaux p√©riph√©riques BLE. Nous allons donc devoir g√©rer des listes qui vont √™tre modifi√©es en temps r√©el. Pour √ßa nous allons utiliser un <code>Flow</code>, le flow sera un flux de donn√©es qui va nous permettre de mettre √† jour notre liste de p√©riph√©riques BLE (visuellement dans notre interface).</p><p>Cette interface sera √©galement recompos√©e √† chaque fois que nous indiquerons ¬´ En Scan ¬ª ou ¬´ Scan termin√© ¬ª.</p><p><img src="'+v+'" alt="Recomposition" loading="lazy"></p><p><a href="https://developer.android.com/jetpack/compose/lifecycle?hl=fr" target="_blank" rel="noreferrer">En savoir plus sur la recomposition</a></p><h3 id="le-viewmodel" tabindex="-1">Le ViewModel <a class="header-anchor" href="#le-viewmodel" aria-label="Permalink to &quot;Le ViewModel&quot;">‚Äã</a></h3><p>Le ViewModel repose sur le d√©coupage du code de type MVVM (Model View ViewModel). Nous allons donc avoir un ViewModel qui va contenir la logique de notre √©cran (ici le scan BLE).</p><p>Je ne souhaite pas dans cette introduction au composant vous assommer avec des d√©tails techniques. Sachez juste que c&#39;est une bonne pratique de d√©couper son code, et que pour √ßa nous allons utiliser un ViewModel dans notre cas.</p><h3 id="evolution-de-la-structure" tabindex="-1">√âvolution de la structure <a class="header-anchor" href="#evolution-de-la-structure" aria-label="Permalink to &quot;√âvolution de la structure&quot;">‚Äã</a></h3><p>Notre projet va √©voluer un peu, voici les √©l√©ments que nous allons devoir ajouter :</p><p><img src="'+C+`" alt="Arborescence" loading="lazy"></p><ul><li><code>ScanViewModel.kt</code> : Le ViewModel qui va contenir la logique de notre √©cran.</li><li><code>ScanScreen.kt</code> : Le composant qui va contenir l&#39;interface de notre √©cran (notre liste et nos boutons d&#39;actions).</li><li><code>ApplicationRoot.kt</code> : Une activit√© qui sera appel√©e par la plateforme Android, elle nous permettra d&#39;avoir acc√®s au contexte de l&#39;application depuis notre ViewModel.</li></ul><div class="tip custom-block"><p class="custom-block-title">Pas d&#39;inqui√©tude</p><p>Ici, il faut bien voir que je vous communique une fa√ßon correcte de faire. Nous pourrions √©videmment tout simplifier en mettant tout dans le m√™me fichier (dans la vue par exemple). Mais √† mon sens, il est important de comprendre d√®s le d√©but les bonnes pratiques.</p><p>Pour revenir au <code>Context</code>, il est possible de le r√©cup√©rer depuis la vue via un <code>LocalContext</code>. Dans le cas pr√©sent cette solution n&#39;est pas possible (ou partiellement), car lors de la ¬´ recomposition ¬ª (en cas de changement dans les donn√©es) de la vue, notre viewModel sera dans certains cas d√©truit et recr√©√© et nous perdrons nos donn√©es.</p></div><h3 id="quelques-libraires-a-ajouter" tabindex="-1">Quelques libraires √† ajouter <a class="header-anchor" href="#quelques-libraires-a-ajouter" aria-label="Permalink to &quot;Quelques libraires √† ajouter&quot;">‚Äã</a></h3><p>Pour que nous puissions faire notre scan en arri√®re-plan et √©changer les donn√©es entre la <code>View</code> et le <code>ViewModel</code> nous allons avoir besoin de quelques librairies :</p><div class="language-groovy vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">implementation(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;androidx.lifecycle:lifecycle-runtime-compose:2.6.2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">implementation(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;androidx.lifecycle:lifecycle-viewmodel-compose:2.6.2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">implementation(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;androidx.lifecycle:lifecycle-viewmodel-ktx:2.6.2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">implementation(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;androidx.lifecycle:lifecycle-runtime-ktx:2.6.2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Ajouter ces d√©pendances dans votre fichier <code>build.gradle</code> (celui dans <code>app</code> du projet). Il faut ensuite synchroniser le projet avec les modifications (bandeau bleu en haut).</p><p><a href="https://developer.android.com/jetpack/androidx/releases/lifecycle" target="_blank" rel="noreferrer">Plus d&#39;informations</a></p><h3 id="le-code-du-scanscreen" tabindex="-1">Le code du ScanScreen <a class="header-anchor" href="#le-code-du-scanscreen" aria-label="Permalink to &quot;Le code du ScanScreen&quot;">‚Äã</a></h3><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@SuppressLint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MissingPermission&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">@Composable</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ScanScreen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    modifier: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Modifier</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Modifier,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    scanViewModel: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ScanViewModel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> viewModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // La liste des appareils scann√©s autour</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scanItems </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">by</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scanViewModel.scanItemsFlow.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">collectAsStateWithLifecycle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Boolean permettant de savoir si nous sommes en train de scanner</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isScanning </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">by</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scanViewModel.isScanningFlow.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">collectAsStateWithLifecycle</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Column</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        modifier </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> modifier.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fillMaxSize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        verticalArrangement </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Arrangement.Center,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        horizontalAlignment </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Alignment.CenterHorizontally</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Boutons en haut de l&#39;√©cran (d√©buter le scan, arr√™ter le scan, vider la liste)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        Row</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(verticalAlignment </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Alignment.CenterVertically, modifier </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Modifier.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">padding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(top </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dp)) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            Button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                colors </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isScanning) ButtonDefaults.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buttonColors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(containerColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Color.Red) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ButtonDefaults.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buttonColors</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                onClick </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { scanViewModel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startScan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                enabled </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">isScanning</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            ) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isScanning) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Scan en cours&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;D√©buter le scan&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            Spacer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(modifier </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Modifier.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">padding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.dp))</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            Button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(onClick </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { scanViewModel.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clearScanItems</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() }) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Vider la liste&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Le scan est lanc√© nous affichons la liste des appareils trouv√©s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        LazyColumn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(modifier </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Modifier.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fillMaxSize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            items</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(scanItems) { item </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                ElementList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    title </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item.device.name ?: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Sans nom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    content </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item.device.address ?: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;00:00:00:00:00:00&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    image </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> R.drawable.baseline_bluetooth_24</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>Quelques explications :</p><ul><li><code>scanViewModel</code> est un param√®tre qui permet de passer le ViewModel √† notre composant. C&#39;est ce que nous appelons une d√©pendance. Nous allons avoir besoin de ce ViewModel pour acc√©der aux donn√©es et aux actions.</li><li><code>scanItems</code> est un √©tat qui va contenir la liste des appareils scann√©s. Cet √©tat va √™tre mis √† jour √† chaque fois que nous allons scanner un nouvel appareil.</li><li><code>isScanning</code> est un √©tat qui va contenir l&#39;√©tat du scan. Cet √©tat va √™tre mis √† jour √† chaque fois que nous allons d√©marrer ou arr√™ter le scan.</li><li><code>LazyColumn</code> est un composant qui permet d&#39;afficher une liste. Il est √©quivalent √† un <code>RecyclerView</code> sur Android sans Compose. Cette liste contiendra autant d&#39;√©l√©ments que d&#39;appareils scann√©s.</li></ul><h3 id="le-code-du-scanviewmodel" tabindex="-1">Le code du ScanViewModel <a class="header-anchor" href="#le-code-du-scanviewmodel" aria-label="Permalink to &quot;Le code du ScanViewModel&quot;">‚Äã</a></h3><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ScanViewModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ViewModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // La liste des appareils scann√©s autour</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scanItemsFlow </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MutableStateFlow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ScanResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt;(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">emptyList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Boolean permettant de savoir si nous sommes en train de scanner</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isScanningFlow </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MutableStateFlow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Le processus de scan</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scanJob: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Job</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">? </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * Le scanner bluetooth</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ApplicationRoot.getContext() est une r√©f√©rence au contexte de l&#39;application</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Elle est initialis√©e dans ApplicationRoot</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bluetoothLeScanner </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ApplicationRoot.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSystemService</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BLUETOOTH_SERVICE) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BluetoothManager).adapter.bluetoothLeScanner</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scanFilters: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ScanFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> emptyList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scanSettings </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ScanSettings.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Builder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setScanMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ScanSettings.SCAN_MODE_LOW_LATENCY).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scanResultsSet </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mutableMapOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ScanResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    @SuppressLint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MissingPermission&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> startScan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(isScanningFlow.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        scanJob </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CoroutineScope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Dispatchers.IO).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">launch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // On indique que nous sommes en train de scanner</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            isScanningFlow.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // Objet qui sera appel√© √† chaque r√©sultat de scan</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            val</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scanCallback </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> object : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ScanCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                override</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onScanResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(callbackType: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, result: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ScanResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                    super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onScanResult</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(callbackType, result)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                    // On ajoute le r√©sultat dans le set, si il n&#39;y est pas d√©j√†</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                    // L&#39;ajout retourne null si l&#39;√©l√©ment n&#39;√©tait pas d√©j√† pr√©sent</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (scanResultsSet.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(result.device.address, result) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                        // On envoie la nouvelle liste des appareils scann√©s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        scanItemsFlow.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scanResultsSet.values.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // On lance le scan BLE a la souscription de scanFlow</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            bluetoothLeScanner.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">startScan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(scanFilters, scanSettings, scanCallback)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            delay</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // Lorsque scanFlow est stopp√©, on stop le scan BLE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            bluetoothLeScanner.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stopScan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(scanCallback)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // On indique que nous ne sommes plus en train de scanner</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            isScanningFlow.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> clearScanItems</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        scanResultsSet.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clear</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        scanItemsFlow.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scanResultsSet.values.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><p>Quelques explications :</p><ul><li><code>scanItemsFlow</code> est un <code>Flow</code> qui va contenir la liste des appareils scann√©s. Ce <code>Flow</code> va √™tre mis √† jour √† chaque fois que nous allons scanner un nouvel appareil.</li><li><code>isScanningFlow</code> est un <code>Flow</code> qui va contenir l&#39;√©tat du scan. Ce <code>Flow</code> va √™tre mis √† jour √† chaque fois que nous allons d√©marrer ou arr√™ter le scan.</li><li><code>scanJob</code> est un <code>Job</code> qui va contenir le processus de scan. Ce <code>Job</code> sera la t√¢che en cours d&#39;ex√©cution. Elle permettrait de l&#39;annuler si besoin.</li><li><code>bluetoothLeScanner</code> est un objet qui permet de scanner les p√©riph√©riques BLE. C&#39;est un objet fourni par Android.</li><li><code>scanFilters</code> est une liste de filtres qui permet de filtrer les p√©riph√©riques scann√©s. Dans notre cas, nous ne filtrons rien.</li><li><code>scanSettings</code> est un objet qui permet de d√©finir les param√®tres du scan. Dans notre cas, nous d√©finissons le mode de scan en <code>SCAN_MODE_LOW_LATENCY</code> (le mode le plus rapide, pour avoir les r√©sultats le plus rapidement possible).</li><li><code>scanResultsSet</code> est un <code>Set</code> qui va contenir les r√©sultats du scan. Nous utilisons un <code>Set</code> pour √©viter d&#39;avoir des doublons dans notre liste.</li><li><code>startScan</code> est une fonction qui permet de d√©marrer le scan. Cette fonction va √™tre appel√©e lors du clique sur le bouton ¬´ D√©buter le scan ¬ª.</li><li><code>clearScanItems</code> est une fonction qui permet de vider la liste des appareils scann√©s. Cette fonction va √™tre appel√©e lors du clique sur le bouton ¬´ Vider la liste ¬ª.</li><li><code>scanCallback</code> est un objet qui va √™tre appel√© √† chaque r√©sultat de scan. Cet objet va nous permettre de mettre √† jour notre liste des appareils scann√©s.</li></ul><p>Ici nous avons un code qui est un peu plus complexe, mais compl√®tement lisible. Il faut juste prendre le temps de le d√©composer et de comprendre ce que nous faisons (notamment le flow et le callback).</p><p>Vous avez des questions ? Je suis l√† üëã.</p><div class="warning custom-block"><p class="custom-block-title"><code>CallBack</code> ?</p><p>Un <code>CallBack</code> est un objet qui va √™tre appel√© √† chaque fois qu&#39;une action est r√©alis√©e. Dans notre cas, nous avons un <code>CallBack</code> qui va √™tre appel√© √† chaque fois que nous allons scanner un nouvel appareil. C&#39;est ce que nous appelons un <code>CallBack</code> ou un <code>Listener</code>.</p></div><h3 id="le-code-de-l-applicationroot" tabindex="-1">Le code de l&#39;ApplicationRoot <a class="header-anchor" href="#le-code-de-l-applicationroot" aria-label="Permalink to &quot;Le code de l&#39;ApplicationRoot&quot;">‚Äã</a></h3><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * Classe permettant de r√©cup√©rer le contexte de l&#39;application</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * depuis n&#39;importe o√π dans le code</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * Pour cela il suffit d&#39;appeler ApplicationRoot.getContext()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * Elle est initialis√©e dans le fichier AndroidManifest.xml</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * application android:name=&quot;.ApplicationRoot&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * Android va automatiquement appeler la m√©thode onCreate() pour nous</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * afin d&#39;initialiser la variable INSTANCE</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ApplicationRoot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Application</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    companion</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> lateinit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> INSTANCE: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Application</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(): </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Context</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> INSTANCE.applicationContext</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    override</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> fun</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onCreate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onCreate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        INSTANCE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>Quelques explications :</p><ul><li><code>ApplicationRoot</code> est une classe qui permet de r√©cup√©rer le contexte de l&#39;application depuis n&#39;importe o√π dans le code. Pour cela il suffit d&#39;appeler <code>ApplicationRoot.getContext()</code>.</li><li><code>getContext()</code> est une fonction qui permet de r√©cup√©rer le contexte de l&#39;application.</li><li><code>Compagnon</code> est un objet qui permet de cr√©er des fonctions et des variables statiques. C&#39;est un peu comme si nous avions une classe avec des fonctions et des variables statiques.</li></ul><h3 id="le-fichier-androidmanifest-xml-1" tabindex="-1">Le fichier AndroidManifest.xml <a class="header-anchor" href="#le-fichier-androidmanifest-xml-1" aria-label="Permalink to &quot;Le fichier AndroidManifest.xml&quot;">‚Äã</a></h3><p>Pour l&#39;instant le code que je vous ai fourni ne fonctionne pas. Il manque une √©tape, nous devons d√©clarer notre <code>ApplicationRoot</code> dans le fichier <code>AndroidManifest.xml</code>. Pour √ßa nous allons ajouter l&#39;attribut <code>android:name</code> √† l&#39;√©l√©ment <code>application</code> :</p><div class="language-xml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">android:name=&quot;.ApplicationRoot&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>√Ä ajouter dans le <code>&lt;Application</code> :</p><p><img src="`+f+'" alt="AndroidManifest.xml" loading="lazy"></p><div class="tip custom-block"><p class="custom-block-title">Pourquoi ?</p><p>En d√©clarant notre <code>ApplicationRoot</code> dans le <code>AndroidManifest.xml</code>, nous indiquons √† Android que nous souhaitons utiliser notre classe <code>ApplicationRoot</code> comme classe principale de notre application. C&#39;est cette classe qui sera appel√©e en premier lors du lancement de l&#39;application.</p><p>Celle-ci n&#39;affichera rien mais elle sera lanc√© en premier. C&#39;est ce que nous appelons un point d&#39;entr√©e, ¬´ elle tiendra ¬ª une r√©f√©rence au contexte de l&#39;application. C&#39;est ce qui nous permettra d&#39;acc√©der au Bluetooth depuis notre ViewModel.</p><p>Il n&#39;y a pour l&#39;instant pas d&#39;autre moyen de faire, c&#39;est une limitation de Compose (ou du moins un comportement / astuce √† connaitre).</p></div><h3 id="c-est-a-vous" tabindex="-1">C&#39;est √† vous <a class="header-anchor" href="#c-est-a-vous" aria-label="Permalink to &quot;C&#39;est √† vous&quot;">‚Äã</a></h3><p>Vous avez l&#39;ensemble des √©l√©ments, je vous laisse le mettre en place dans votre application.</p><p>Une fois le code en place, vous devrez l&#39;appeler depuis votre ¬´ MainActivity ¬ª √† la place du <code>ListScreen</code>. Dans mon cas :</p><div class="language-kotlin vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">kotlin</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ScanScreen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Modifier.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">padding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(it))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="arretons-nous-un-instant" tabindex="-1">Arr√™tons-nous un instant <a class="header-anchor" href="#arretons-nous-un-instant" aria-label="Permalink to &quot;Arr√™tons-nous un instant&quot;">‚Äã</a></h2><p>Ici l&#39;id√©e √©tait de vous montrer les bases de la cr√©ation de composants. Il est √©vident que dans une vraie application, nous aurions un peu plus que √ßa.</p><p>Notamment :</p><ul><li>Une architecture (MVI, MVVM, etc.) qui permet de g√©rer la logique de l&#39;application. Dans Compose nous appelons √ßa un ViewModel.</li><li>Une Navigation bas√©e sur un Routeur, sur Android il se nomme Jetpack Compose Navigation.</li><li>Une gestion des erreurs, des exceptions, etc.</li></ul><p>Mais pour l&#39;instant, nous allons nous arr√™ter l√†. Nous avons vu les bases, nous avons vu comment cr√©er des composants, comment les utiliser, comment les animer, comment les rendre interactifs, etc.</p><h2 id="aller-plus-loin-dans-la-navigation" tabindex="-1">Aller plus loin dans la navigation <a class="header-anchor" href="#aller-plus-loin-dans-la-navigation" aria-label="Permalink to &quot;Aller plus loin dans la navigation&quot;">‚Äã</a></h2><p>Vous souhaitez aller plus loin ? L√† c&#39;est un exemple tr√®s simple, pour d√©couvrir. Dans une application plus complexe, nous aurions besoin de Compose Navigation pour g√©rer les transitions entre les composants. Vous pouvez retrouver un exemple d&#39;utilisation de Compose Navigation dans la documentation officielle : <a href="https://developer.android.com/jetpack/compose/navigation" target="_blank" rel="noreferrer">Compose Navigation</a>.</p><p>Compose Navigation est un composant qui permet de g√©rer les transitions entre les composants. Il permet de g√©rer les animations, les transitions, les arguments, etc. C&#39;est l&#39;√©quivalent d&#39;un routeur dans une application web (react-router, vue-router, etc.)</p><h2 id="bonus-adapter-la-topappbar" tabindex="-1">Bonus : Adapter la TopAppBar <a class="header-anchor" href="#bonus-adapter-la-topappbar" aria-label="Permalink to &quot;Bonus : Adapter la TopAppBar&quot;">‚Äã</a></h2><p>Actuellement votre TopAppBar est statique, elle contient toujours la m√™me chose √† savoir ¬´ Top App Bar ¬ª. Je vous propose de r√©fl√©chir √† comment faire pour que celle-ci s&#39;adapte et change en fonction de l&#39;√©l√©ment choisi, en fonctionnant en suivant la logique :</p><ul><li>Aucun √©l√©ment = ¬´ Nom de votre application ¬ª.</li><li>Un √©l√©ment choisi = ¬´ Titre de l&#39;√©l√©ment choisi ¬ª.</li></ul><div class="tip custom-block"><p class="custom-block-title">Et les animations</p><p>N&#39;oubliez pas, les animations sont le d√©tail qui change tout. Je vous laisse regarder pour faire en sorte d&#39;animer le changement de titre.</p></div><p><img src="'+A+'" alt="Le r√©sultat de la TopAppBar" loading="lazy"></p><h2 id="le-code-complet" tabindex="-1">Le code complet <a class="header-anchor" href="#le-code-complet" aria-label="Permalink to &quot;Le code complet&quot;">‚Äã</a></h2><p>M√™me si je vous ai donn√© le code au fur et √† mesure, je vous laisse le code complet de l&#39;application :</p><p><a href="https://github.com/c4software/Android-Composant-sample-ble-scan" target="_blank" rel="noreferrer">Code complet</a></p><p>PS: Je vous conseil de cr√©er vous m√™me votre application, c&#39;est en forgeant que l&#39;on devient forgeron.</p>',66),T=[B,D,x,S,_,L,w];function j(M,P,I,V,N,z){return e(),n("div",null,T)}const O=a(q,[["render",j]]);export{U as __pageData,O as default};
