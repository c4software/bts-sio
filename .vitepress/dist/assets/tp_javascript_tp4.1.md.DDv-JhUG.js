import{_ as s,c as e,o as i,U as a}from"./chunks/framework.aGaNZw_P.js";const n="/assets/maquette.ChN9CvGk.png",t="/assets/base.BNU3W_71.png",l="/assets/space.BhNona1I.png",p="/assets/random.DQ75rogj.png",r="/assets/bretagne.CSeHAaEa.png",b=JSON.parse('{"title":"La Greta TV 2.0 (Ajax)","description":"Nous avons cr√©√© deux cas ¬´ de tests ¬ª, je vous propose de le mettre en place dans un code existant.","frontmatter":{"description":"Nous avons cr√©√© deux cas ¬´ de tests ¬ª, je vous propose de le mettre en place dans un code existant."},"headers":[],"relativePath":"tp/javascript/tp4.1.md","filePath":"tp/javascript/tp4.1.md","lastUpdated":1699133994000}'),o={name:"tp/javascript/tp4.1.md"},h=a(`<h1 id="la-greta-tv-2-0-ajax" tabindex="-1">La Greta TV 2.0 (Ajax) <a class="header-anchor" href="#la-greta-tv-2-0-ajax" aria-label="Permalink to &quot;La Greta TV 2.0 (Ajax)&quot;">‚Äã</a></h1><p>Nous avons cr√©√© deux cas ¬´ de tests ¬ª, je vous propose de le mettre en place dans un code existant. Nous avons r√©alis√© un site la GRETA TV, ce site comportait <strong>¬´ deux pages ¬ª</strong> :</p><ul><li>Une page d&#39;accueil <code>home.php</code>, qui affiche la liste des vid√©os.</li><li>Une page <code>tv.php</code> ayant pour but l&#39;affichage de la vid√©o souhait√©.</li></ul><div class="tip custom-block"><p class="custom-block-title">Vous n&#39;avez pas le code source ?</p><p>Celui-ci est <a href="/demo/php/greta-tv/refactor-structure.zip">disponible ici</a>. Il pourra vous servir de base de travail. (c&#39;est une version sans base de donn√©es, pour simplifier l&#39;installation locale)</p></div><div class="tip custom-block"><p class="custom-block-title">Vous pr√©f√©rez une approche MVC ?</p><p>La premi√®re version du code source fourni est tr√®s simple. En tant que d√©veloppeur, on pr√©f√®re une approche un peu plus compl√®te que celle-ci. C&#39;est pour √ßa que je vous propose plut√¥t d&#39;utiliser la version MVC du projet.</p><p>Celui-ci est <a href="https://github.com/c4software/demo-structure-mvc-video/archive/refs/tags/1.1.zip" target="_blank" rel="noreferrer">disponible ici</a>. La <a href="/tp/php/mvc/tp1.html">documentation est disponible ici</a></p><p><strong>Attention</strong>, la suite du TP repose sur la premi√®re version du code source. Les nommages sont diff√©rents, mais globalement le fonctionnement reste le m√™me. Si vous voulez jouer, tentez la version MVC.</p></div><p>Comment allons-nous proc√©der ?</p><ul><li>Dans un premier temps, nous allons regarder le fonctionnement du site actuel.</li><li>Puis, nous allons supprimer les parties PHP ¬´ qui affichent les vid√©os ¬ª. Nous testerons que notre code fonctionne toujours, mais en n‚Äôaffichant aucune vid√©o.</li><li>Nous allons par la suite cr√©er une API. Son but ? Retourner uniquement le contenu (au format JSON bien entendu)</li><li>Puis nous appellerons notre API en Ajax gr√¢ce √† Fetch depuis notre page.</li></ul><h2 id="la-page-home-php" tabindex="-1">La page <code>home.php</code> <a class="header-anchor" href="#la-page-home-php" aria-label="Permalink to &quot;La page \`home.php\`&quot;">‚Äã</a></h2><p>Nous allons rendre dynamique la page d&#39;accueil <code>home.php</code>, dans le sens o√π :</p><ul><li>Notre serveur va g√©n√©rer une page ¬´ Vide ¬ª (c&#39;est-√†-dire sans la liste de vid√©os).</li><li>Notre navigateur va, via un appel Ajax charger la liste des vid√©os, et se charger en JavaScript de l&#39;affichage de la liste.</li></ul><p>Avant tout, <strong>pourquoi faire √ßa ?</strong> L&#39;avantage de d√©couper le traitement comme √ßa. C&#39;est que nous pourrions tr√®s simplement cr√©er un client ¬´ Mobile ¬ª, et √ßa sans toucher au code de notre serveur. Pleins d&#39;avantages :</p><ul><li>Code unique pour le Web et les autres plateformes</li><li>Centralisation de la logique dans un code d√©di√© √† la r√©cup√©ration ¬´ du contenu ¬ª (les vid√©os en l&#39;occurrence).</li><li>Approche microservices, nous pouvons donc h√©berger notre site Internet sur une autre plateforme que l&#39;API.</li></ul><div class="danger custom-block"><p class="custom-block-title">Un INSTANT !</p><p>Une API ? What ? Alors, une API dans le fond c&#39;est ¬´ comme un site web ¬ª. Mais, cette page web ne produit pas du HTML et n&#39;a pas pour vocation d&#39;√™tre lue par un humain.</p><p>C&#39;est donc du code (PHP ou autre) qui va permettre de faire parler deux ordinateurs (le client et le serveur) dans un langage sp√©cifique (XML, JSON ‚Ä¶)</p></div><h3 id="etape-1-analyse-du-code" tabindex="-1">√âtape 1 : Analyse du code <a class="header-anchor" href="#etape-1-analyse-du-code" aria-label="Permalink to &quot;√âtape 1 : Analyse du code&quot;">‚Äã</a></h3><p>La premi√®re √©tape va √™tre de cr√©er l&#39;API, nous allons donc regarder comment fonctionne le code que vous avez t√©l√©charg√©. Je vous laisse regarder, une fois analys√©, nous allons en parler ensemble.</p><details class="details custom-block"><summary>Analyse du code</summary><p>Le code qui nous int√©resse est pr√©sent dans le fichier <code>home.php</code> ; celui-ci contient quelques lignes de code, mais si nous y regardons de plus pr√®s seules quelques lignes sont int√©ressantes :</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">php</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$videos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;BcgsOgjHgWA&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;lcOxhH8N3Bo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;jTuBnZrLbq0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;M2VtfZDOcHQ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;i1iIaSbK9bg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MTaHw-S6IDo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;KfMCApWc5xE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;igtN49I1CtM&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">foreach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($videos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $id) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">div</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;col-sm-12 col-md-3 p-3&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">div</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;card&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">div</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;card-body text-center&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">a</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> href</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;index.php?page=tv&amp;id=&lt;?=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">?&gt;&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;btn btn-outline-primary&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Video</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;?=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?&gt;&lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">a</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            &lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">div</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        &lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">div</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">div</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">php</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>Nous pouvons y voir un exemple de code PHP tr√®s simple √† savoir :</p><ul><li>Une variable <code>$videos</code>, celle-ci contient la liste des vid√©os √† afficher. <em>C&#39;est notre source de donn√©es</em>.</li><li><code>$i</code> est une variable qui permettra d&#39;afficher <code>Video X</code> (1‚Ä¶ X). <em>Note, cette variable peut-√™tre remplac√©e par une boucle foreach diff√©rente <code>foreach $videos as $i =&gt; $id</code></em></li><li>Du code HTML, celui-ci permet d&#39;afficher une liste de Card √† la suite avec dedans un bouton permettant d&#39;acc√©der √† la page <code>tv.php</code>.</li></ul></details><hr><p>Une autre partie du code est int√©ressante, le fichier <code>index.php</code> ; ce fichier est un entrypoint, c&#39;est une bonne pratique que je vous encourage vraiment √† pratiquer. Regardons le fichier ensemble ! Et plus particuli√®rement la variable, <code>$whitelist</code> celle-ci contient la liste des pages <strong>autoris√©es</strong>.</p><div class="tip custom-block"><p class="custom-block-title">Whitelist ?</p><p>La s√©curit√©, vous connaissez ? J&#39;esp√®re, quand vous d√©veloppez un site Internet, vous √™tes par d√©finition ¬´ en short ¬ª sur la toile. Votre site peut-√™tre et sera certainement (je vous le garantis pour l&#39;avoir v√©cue) pirat√© par une personne malveillante. Comment s&#39;en pr√©munir alors ? Tout simplement emp√™chant au maximum l&#39;exploitation de probl√®me connut.</p><p>Cr√©er une <code>whitelist</code> va nous permettre de dormir paisiblement, nous allons contr√¥ler finement ce que l&#39;utilisateur va pouvoir inclure. Vous retrouverez cette pratique dans diff√©rents langages sous diff√©rent nom (Un <code>router</code> peut-√™tre assimil√© √† ce genre de pratique).</p></div><hr><p>Le pr√©c√©dent d√©veloppeur a visiblement travaill√© pour vous‚Ä¶ üòâ üòâ. Vous trouverez √©galement dans le projet un fichier <code>api.php</code> ainsi qu&#39;un dossier <code>api</code> celui-ci contient le code permettant de :</p><ul><li>D√©clarer des API. (dossier <code>api/</code>)</li><li>S√©curiser les API.</li><li>Centraliser la gestion de celle-ci. (<code>api.php</code>)</li></ul><div class="tip custom-block"><p class="custom-block-title">üëÄ Vous pouvez tester d√®s maintenant üëÄ</p><p>Vous avez une API de disponible dans le projet. Celle-ci contient du contenu fictif, vous pouvez l&#39;appeler avec le lien :</p><ul><li><a href="http://localhost/leDossierDeVotreProjet/api.php?page=sample" target="_blank" rel="noreferrer">http://localhost/leDossierDeVotreProjet/api.php?page=sample</a></li></ul><p>ü§ì Je vous laisse tester.</p></div><h3 id="etape-2-creer-l-api" tabindex="-1">√âtape 2 : Cr√©er l&#39;API <a class="header-anchor" href="#etape-2-creer-l-api" aria-label="Permalink to &quot;√âtape 2 : Cr√©er l&#39;API&quot;">‚Äã</a></h3><p>Nous avons maintenant analys√© le code actuellement fonctionnel. Nous allons donc cr√©er une API qui devra retourner ¬´ seulement la liste des vid√©os ¬ª. Nous allons utiliser la fonction <code>json_encode</code> fournie <strong>de base</strong> en PHP.</p><p>Cette fonction permet :</p><blockquote><p>Retourne une chaine de caract√®res contenant la repr√©sentation JSON de la valeur value.</p><p>L&#39;encodage est affect√© par les flags fournis. De plus, l&#39;encodage des valeurs flottantes d√©pend de la valeur de serialize_precision.</p></blockquote><p><em>Source:</em> <a href="https://www.php.net/manual/fr/function.json-encode.php" target="_blank" rel="noreferrer">https://www.php.net/manual/fr/function.json-encode.php</a></p><p>Cette fonction nous permet donc de transformer une <code>variable</code> en quelque chose de transf√©rable simplement vers un autre syst√®me. Ce quelque chose est du JSON :</p><blockquote><p>JSON est un format de donn√©es textuelles d√©riv√© de la notation des objets du langage JavaScript. Il permet de repr√©senter de l‚Äôinformation structur√©e comme le permet XML par exemple.</p></blockquote><p><em>Source:</em> Wikip√©dia</p><h4 id="place-au-code" tabindex="-1">Place au code <a class="header-anchor" href="#place-au-code" aria-label="Permalink to &quot;Place au code&quot;">‚Äã</a></h4><p>Nous devons donc √©crire une API‚Ä¶ Une API c&#39;est <strong>juste un fichier PHP</strong> comme un autre ; √† la seule diff√©rence que celui-ci ne retourne pas du HTML, mais du JSON. Vous avez un exemple d&#39;API dans le projet avec le fichier <code>sample.php</code>, je vous laisse le regarder‚Ä¶</p><p>Une fois celui-ci analys√©, je vous laisse cr√©er votre fichier, par exemple <code>videos.php</code> <strong>dans le dossier <code>api/</code></strong> √ßa sera notre futur API ! Nous avons maintenant une API <strong>vide</strong> ! Mais que mettre dedans ?</p><ul><li>√Ä votre avis ?</li><li>Du code PHP üòÆ</li><li>La r√©ponse D ?</li></ul><p>Je vous aide! Nous allons y mettre du code PHP‚Ä¶ Et plus particuli√®rement le contenu de <strong>notre source de donn√©es</strong> ! Mais quel code √† votre avis ?</p><ul><li>Vous allez devoir cr√©er la variable <code>$videos</code> (comme sur la home).</li><li>Utiliser la fonction <code>json_encode</code> et <code>echo</code> pour envoyer le contenu de la variable au client au format JSON.</li></ul><details class="details custom-block"><summary>En panne d&#39;inspiration ?</summary><p>Je vous aide :</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    &lt;?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">php</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        $videos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;BcgsOgjHgWA&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;lcOxhH8N3Bo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;jTuBnZrLbq0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;M2VtfZDOcHQ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;i1iIaSbK9bg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MTaHw-S6IDo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;KfMCApWc5xE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;igtN49I1CtM&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        echo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> json_encode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($videos);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ?&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></details><p>Je vous laisse mettre en place l&#39;API dans votre code. <strong>N&#39;oubliez pas de la tester !</strong></p><div class="tip custom-block"><p class="custom-block-title">L&#39;astuce du chef</p><p>Pour tester votre API, vous avez la possibilit√© d‚Äôutiliser le logiciel PostMan. PostMan va vous permettre de tester vos API simplement avec une interface graphique.</p><p>T√©l√©chargez-le <a href="https://www.getpostman.com/" target="_blank" rel="noreferrer">ici</a></p></div><h3 id="etape-2-modifier-le-code-existant" tabindex="-1">√âtape 2 : Modifier le code existant <a class="header-anchor" href="#etape-2-modifier-le-code-existant" aria-label="Permalink to &quot;√âtape 2 : Modifier le code existant&quot;">‚Äã</a></h3><p>Je vous laisse modifier le code PHP de la page <code>home.php</code> pour le vider de tout <code>PHP</code> celui-ci doit-√™tre vide ! Il ne va contenir que le minimum √† savoir la structure interne de la page :</p><div class="language-html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;container&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;container&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;row pt-5&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      &lt;!-- Nous allons ins√©rer ICI le contenu grace √† l&#39;AJAX --&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Vous ajouterez ici prochainement le code JavaScript permettant de faire l&#39;appel Ajax (avec fetch)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="etape-3-appeler-l-api-en-ajax" tabindex="-1">√âtape 3 : Appeler l&#39;API en Ajax <a class="header-anchor" href="#etape-3-appeler-l-api-en-ajax" aria-label="Permalink to &quot;√âtape 3 : Appeler l&#39;API en Ajax&quot;">‚Äã</a></h3><p>Comme nous l&#39;avons fait pr√©c√©demment, je vous laisse reprendre le code. Mais le code va ressembler √† :</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./api.php?page=videos&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">response</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> response.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">datas</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Votre code ICI, vous devez parcourir les vid√©os (comme dans l&#39;exemple pr√©c√©dent) pour les ajouter dans le #content (comme dans l&#39;exemple pr√©c√©dent)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><details class="details custom-block"><summary>√† court d&#39;id√©es sur le code √† √©crire ?</summary><p>NON ? Vous n&#39;allez pas tricher comme √ßa‚Ä¶ Non pas vous ?</p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// √Ä mettre dans le then</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">datas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">el</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getElementById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;content&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">insertAdjacentHTML</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;beforeend&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    \`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &lt;div class=&quot;col-sm-12 col-md-3 p-3&quot;&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &lt;div class=&quot;card&quot;&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &lt;div class=&quot;card-body text-center&quot;&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &lt;a href=&quot;index.php?page=tv&amp;id=\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">el</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&quot; class=&quot;btn btn-outline-primary&quot;&gt;Video \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}&lt;/a&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &lt;/div&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &lt;/div&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &lt;/div&gt;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    \`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    );</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>‚ö†Ô∏è Non‚Ä¶ Ce n&#39;est pas la seule fa√ßon de faire. Maintenant que vous avez vu MA solution. Je vous laisse √©crire la v√¥tre.</p></details><p>ü§ì Je vous laisse travailler √† la mise en place du code en question. Tester ensuite que la page s&#39;affiche comme pr√©c√©demment.</p><h3 id="etape-4-evolution-de-la-page" tabindex="-1">√âtape 4 : √âvolution de la page <a class="header-anchor" href="#etape-4-evolution-de-la-page" aria-label="Permalink to &quot;√âtape 4 : √âvolution de la page&quot;">‚Äã</a></h3><p>Ajouter un bouton rafra√Æchir dans la page. Le bouton rafra√Æchir doit permettre de r√©cup√©rer √† nouveau la liste des vid√©os pour les mettre √† jour dans la page.</p><ul><li>Ajouter une ic√¥ne √† droite dans l&#39;interface.</li><li>Utiliser les ic√¥nes fournies par bootstrap.</li><li>Ajouter une action <code>onClick</code> permettant de d√©clencher l&#39;action (<code>function</code>) permettant d&#39;obtenir les vid√©os en Ajax (c&#39;est le code que vous avez d√©j√† √©crit)</li></ul><p>Voil√† la maquette :</p><p><img src="`+n+`" alt="Maquette rendue" loading="lazy"></p><h2 id="allons-plus-loin" tabindex="-1">Allons plus loin <a class="header-anchor" href="#allons-plus-loin" aria-label="Permalink to &quot;Allons plus loin&quot;">‚Äã</a></h2><p>Nous avons fait la page <code>home.php</code> ensemble. Actuellement, nous avons un fond ¬´ brick ¬ª sur la page TV (<code>tv.php</code>) ; je vous propose de changer cette page ! Pour √ßa vous allez devoir proc√©der √† diff√©rents ajustements :</p><ul><li>Ajouter dans la structure de donn√©es la notion de th√®me. (un th√®me diff√©rent par vid√©o)</li><li>Retourner dans <strong>une nouvelle</strong> API (<code>getVideoDetails</code>), les informations n√©cessaires au bon affichage du th√®me.</li><li>Utiliser le retour dans votre page.</li></ul><details class="details custom-block"><summary>Quelques √©l√©ments en plus pour vous aider</summary><ul><li>Vous allez avoir besoin √©videmment de <code>fetch</code> (ou de jQuery) afin de faire l&#39;appel Ajax.</li><li>Votre API doit retourner la class CSS √† appliquer au <code>body</code>.</li><li>Vous pouvez appliquer la class CSS via : <code>document.body.classList.add(&quot;votreClass&quot;)</code>.</li></ul><p>Comme dans le premier exemple, vous devez utiliser le r√©sultat de votre API, cette fois-ci le JSON n&#39;est pas obligatoire, voil√† une piste de r√©ponse :</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;lurldevotreapi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">r</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> r.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resultat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.body.classList.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(resultat));</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></details><p>Voil√† quelques exemples du r√©sultat :</p><p><img src="`+t+'" alt="Base" loading="lazy"><img src="'+l+'" alt="Space" loading="lazy"><img src="'+p+'" alt="Random" loading="lazy"><img src="'+r+'" alt="Bretagne" loading="lazy"></p><h2 id="l-etape-bonus" tabindex="-1">L&#39;√©tape bonus <a class="header-anchor" href="#l-etape-bonus" aria-label="Permalink to &quot;L&#39;√©tape bonus&quot;">‚Äã</a></h2><p>Je vous ai indiqu√© en introduction que le but de cr√©er des API √©tait de permettre de cr√©er simplement plusieurs clients avec comme source de donn√©es la m√™me information. Je vous propose donc de mettre √ßa en pratique ! Nous allons donc cr√©er un autre client web qui consommera nos donn√©es. Voil√† les √©l√©ments que vous devrez r√©aliser :</p><ul><li>Le client Web devra √™tre h√©berg√© sur <a href="https://www.netlify.com" target="_blank" rel="noreferrer">Netlify</a>.</li><li>Avoir un visuel diff√©rent de votre page (home.php) actuelle. (Vous pouvez vous inspirer de YouTube par exemple ou Twitch).</li><li>Avoir une information indiquant chargement pendant la r√©cup√©ration de la liste des vid√©os.</li></ul><div class="warning custom-block"><p class="custom-block-title">Un instant !</p><p>Lors de votre d√©veloppement, vous allez rencontrer un probl√®me de Cross Origin. Le Cross Origin Resource Sharing (CORS) est une protection int√©gr√©e dans votre navigateur qui vous emp√™che depuis le domaine A d&#39;appeler une ressource sur le domaine B. La raison ? Elle est simple emp√™cher le partage non d√©sir√© d&#39;information entre deux sites.</p><p>En tant que d√©veloppeur (si si), vous pouvez contr√¥ler comment fonctionne cette protection. Vous pouvez dans vos API d√©cider qui vous appellera (quel domaine), de mani√®re fine ou de mani√®re compl√®tement ouverte (<code>*</code>). Pour rendre votre code le plus permissif possible vous pouvez ajouter dans votre API PHP le code suivant (tout en haut) :</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Access-Control-Allow-Origin: *&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Vous pouvez √©videmment √™tre plus pr√©cis, en indiquant un domaine sp√©cifique :</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Access-Control-Allow-Origin: https://www.example.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></div>',63),d=[h];function u(c,k,g,E,m,v){return i(),e("div",null,d)}const F=s(o,[["render",u]]);export{b as __pageData,F as default};
