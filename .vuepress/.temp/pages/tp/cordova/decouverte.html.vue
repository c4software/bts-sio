<template><h1 id="decouverte-de-cordova" tabindex="-1"><a class="header-anchor" href="#decouverte-de-cordova" aria-hidden="true">#</a> DÃ©couverte de Cordova</h1>
<p>Dans ce TP vous allez dÃ©couvrir la ligne de commande Cordova et crÃ©er votre premier TP. Comme les autres TP, utiliser lâ€™aide mÃ©moire Cordova pour trouver les bonnes commandes Ã  chaque Ã©tape.</p>
<h2 id="ressources" tabindex="-1"><a class="header-anchor" href="#ressources" aria-hidden="true">#</a> Ressources</h2>
<ul>
<li><a href="https://cordova.apache.org" target="_blank" rel="noopener noreferrer">Le site Cordova<ExternalLinkIcon/></a></li>
<li><a href="https://cordova.apache.org/plugins/" target="_blank" rel="noopener noreferrer">Les plug-ins Cordova<ExternalLinkIcon/></a></li>
<li><a href="https://github.com/c4software/cheatsheet/tree/master/cordova" target="_blank" rel="noopener noreferrer">Aide mÃ©moire Cordova<ExternalLinkIcon/></a></li>
</ul>
<h2 id="installation-de-cordova" tabindex="-1"><a class="header-anchor" href="#installation-de-cordova" aria-hidden="true">#</a> Installation de Cordova</h2>
<p>Pour pouvoir utiliser Cordova, vous allez devoir installer le <code>cordova-cli</code>. La ligne de commande Cordova utilise NodeJS pour fonctionner.</p>
<p>(Normalement NodeJS est dÃ©jÃ  installÃ© sur votre poste).</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> -g cordova
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Lâ€™installation prend quelques minutes, un certain nombre de dÃ©pendances NodeJS sont nÃ©cessaires au bon fonctionnement.</p>
<p>âš ï¸ Lâ€™installation de Cordova est Ã  effectuer quâ€™une seule fois sur lâ€™ordinateur.</p>
<h2 id="android" tabindex="-1"><a class="header-anchor" href="#android" aria-hidden="true">#</a> Android</h2>
<p>Dans le TP, vous allez devoir compiler pour la plateforme Android. VÃ©rifier que celle-ci est bien installÃ©e en le lanÃ§ant une premiÃ¨re fois.</p>
<ul>
<li>Installer la derniÃ¨re version du SDK &amp; la version 28.</li>
</ul>
<h2 id="creation-du-projet-Â«-demo-Â»" tabindex="-1"><a class="header-anchor" href="#creation-du-projet-Â«-demo-Â»" aria-hidden="true">#</a> CrÃ©ation du projet Â« dÃ©mo Â»</h2>
<p>La ligne de commande cordova fournit lâ€™ensemble des Ã©lÃ©ments pour crÃ©er un nouveau projet. Le projet que vous allez crÃ©er contient une premiÃ¨re Â« page Web Â» permettant dâ€™avoir un projet Cordova directement fonctionnel.</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>cordova create demo com.chevrollier.demo Demo
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>âš ï¸ Plusieurs paramÃ¨tres sont nÃ©cessaires Ã  la commande, attention Ã  bien les choisir du maintenant.</p>
<h2 id="ajout-d-une-plateforme" tabindex="-1"><a class="header-anchor" href="#ajout-d-une-plateforme" aria-hidden="true">#</a> Ajout dâ€™une plateforme</h2>
<p>Votre projet est maintenant prÃªt vous allez pouvoir ajout une plateforme. Pour rappel Cordova est un framework de dÃ©veloppement capable de gÃ©rer plusieurs plateformes :</p>
<ul>
<li>android</li>
<li>ios</li>
<li>browser</li>
<li>â€¦</li>
</ul>
<p>Pour commencer nous allons ajouter la plateforme Â« gÃ©nÃ©rique Â» Ã  savoir browser, celle-ci nous permettra de tester simplement notre configuration.</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>cordova platform <span class="token function">add</span> browser

Using cordova-fetch <span class="token keyword">for</span> cordova-browser@~4.1.0
Adding browser project<span class="token punctuation">..</span>.
Creating Browser project. Path: platforms/browser
Discovered plugin <span class="token string">"cordova-plugin-whitelist"</span> <span class="token keyword">in</span> config.xml. Adding it to the project
Installing <span class="token string">"cordova-plugin-whitelist"</span> <span class="token keyword">for</span> browser
Adding cordova-plugin-whitelist to package.json
Saved plugin info <span class="token keyword">for</span> <span class="token string">"cordova-plugin-whitelist"</span> to config.xml
--save flag or autosave detected
Saving browser@~4.1.0 into config.xml <span class="token function">file</span> <span class="token punctuation">..</span>.
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>La plateforme Ã©tant maintenant ajoutÃ© nous pouvons Â« dÃ©marrer Â» Cordova en utilisant la commande :</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>cordova run browser
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><img src="@source/tp/cordova/ressources/run.png" alt="Premier lancement"></p>
<p>Et voilÃ , le code de dÃ©mo tourne dans votre navigateur, gÃ©nial non ? Bon je vois bien que vous Ãªtes dÃ©Ã§uâ€¦</p>
<h2 id="ajouter-une-seconde-plateforme" tabindex="-1"><a class="header-anchor" href="#ajouter-une-seconde-plateforme" aria-hidden="true">#</a> Ajouter une seconde plateforme</h2>
<p>Bon lâ€™intÃ©rÃªt de Cordova câ€™est vraiment le mobile, lâ€™utilisation de la plateforme Â« browser Â» va nous permettre de valider notre dÃ©veloppement sans avoir Ã  brancher son mobile pour valider le fonctionnement.</p>
<p>Pour ajouter la plateforme Android la commande est la suivante :</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>cordova platform <span class="token function">add</span> android
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Une fois ajouter nous allons pouvoir Â« lancer Â» / Â« compiler Â» des applications pour Android.</p>
<p>âš ï¸ Attention, Ã  cette Ã©tape nous avons besoin dâ€™un poste correctement Ã©quipÃ© pour compiler de lâ€™Android</p>
<h2 id="lancer-l-application" tabindex="-1"><a class="header-anchor" href="#lancer-l-application" aria-hidden="true">#</a> Lancer lâ€™application</h2>
<p>Pour lancer lâ€™application, vous avez deux solutions :</p>
<ul>
<li>Votre tÃ©lÃ©phone.</li>
<li>Un Ã©mulateur (celui du SDK, Bluestack, Genymotion).</li>
</ul>
<h2 id="installation-de-genymotion" tabindex="-1"><a class="header-anchor" href="#installation-de-genymotion" aria-hidden="true">#</a> Installation de Genymotion</h2>
<p>Sous Windows vous avez la possibilitÃ© dâ€™installer lâ€™Ã©mulateur Genymotion, pour installer celui-ci rendez-vous sur <a href="https://www.genymotion.com/#!/" target="_blank" rel="noopener noreferrer">le site officiel<ExternalLinkIcon/></a>.</p>
<p>Sur lâ€™Ã©mulateur le dÃ©bogage est dÃ©jÃ  activÃ©.</p>
<h2 id="lancer-l-application-sur-votre-telephone" tabindex="-1"><a class="header-anchor" href="#lancer-l-application-sur-votre-telephone" aria-hidden="true">#</a> Lancer lâ€™application sur votre tÃ©lÃ©phone</h2>
<p>Maintenant que nous avons notre plateforme de prÃªte, lanÃ§ons lâ€™application sur un tÃ©lÃ©phone Android (oui, pour iOs il faut un Mac).</p>
<h3 id="_1-activer-le-mode-developpeur" tabindex="-1"><a class="header-anchor" href="#_1-activer-le-mode-developpeur" aria-hidden="true">#</a> 1. Activer le mode dÃ©veloppeur</h3>
<p>Sur votre tÃ©lÃ©phone, vous devez activer le mode dÃ©veloppeur pour lancer une application depuis un ordinateur. Pour lâ€™activer, rendez-vous dans les ParamÃ¨tres gÃ©nÃ©raux de lâ€™onglet SystÃ¨me, pour ensuite ouvrir le volet Ã€ propos de lâ€™appareil. Une fois que cela est fait, il vous suffit de tapoter par quatre fois le NumÃ©ro de Build pour dÃ©bloquer les Options pour les dÃ©veloppeurs.</p>
<p>Le mode dÃ©veloppeur dÃ©bloque les options Â« avancÃ© Â» de votre tÃ©lÃ©phone Android. Vous allez pouvoir activer le lancement Ã  distance dâ€™application (avec adb).</p>
<p>Dans le nouveau Menu activer :</p>
<ul>
<li>Le mode dÃ©bogage USB pour copier des donnÃ©es entre le terminal et lâ€™ordinateur, installer des applications sur votre appareil.</li>
</ul>
<h3 id="_2-installer-le-driver-adb-pour-l-ordinateur" tabindex="-1"><a class="header-anchor" href="#_2-installer-le-driver-adb-pour-l-ordinateur" aria-hidden="true">#</a> 2. Installer le driver adb pour lâ€™ordinateur</h3>
<p>Votre tÃ©lÃ©phone est un pÃ©riphÃ©rique usb comment un autre, pour dialoguer avec votre ordinateur a besoin dâ€™un driver. De base votre tÃ©lÃ©phone est une sorte de Â« clef usb Â». Une fois le debug actif il va devenir un Â« Android Debug Bridge Device Â». Ce mode-lÃ  nâ€™est par dÃ©faut pas connu par Windows (quelques soit la version), vous devez donc installer un driver. Nous allons utiliser Â« Universal Adb Drivers Â» fourni par Clockworkmod :</p>
<ul>
<li>Brancher votre tÃ©lÃ©phone au PC.</li>
<li><a href="https://adb.clockworkmod.com/" target="_blank" rel="noopener noreferrer">TÃ©lÃ©charger<ExternalLinkIcon/></a></li>
</ul>
<h3 id="_3-lancer-l-application-sur-votre-mobile" tabindex="-1"><a class="header-anchor" href="#_3-lancer-l-application-sur-votre-mobile" aria-hidden="true">#</a> 3. Lancer lâ€™application sur votre mobile</h3>
<p>Maintenant que votre mobile est reconnu (il faut peut-Ãªtre dÃ©brancher et rebrancher votre mobile pour que Ã§a fonctionne Ã  100%), nous allons lancer lâ€™application sur votre mobile, pour Ã§a câ€™est trÃ¨s simple il suffit de faire sur votre ordinateur :</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>cordova run android
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="_4-voir-debugger-le-code-de-l-application-sur-votre-mobile" tabindex="-1"><a class="header-anchor" href="#_4-voir-debugger-le-code-de-l-application-sur-votre-mobile" aria-hidden="true">#</a> 4. Voir / DÃ©bugger le code de lâ€™application sur votre mobile</h3>
<p>Maintenant que lâ€™application fonctionne sur votre mobile, vous pouvez le dÃ©bugger en temps rÃ©el. Les modifications ne sont bien sÃ»r par permanente par contre elle vous permette de tester des modifications sans pour autant avoir a recompiler votre application. Pour Ã§a rien de plus simple il suffit dâ€™utiliser Google Chrome, dans les options Â« avancÃ©s Â» de Chrome nous avons le remote debbugging et câ€™est cette option qui nous intÃ©resse :</p>
<ul>
<li>Ouvrez un nouvel onglet Chrome <RouterLink to="/tp/cordova/chrome:/inspect/#devices">chrome://inspect/#devices</RouterLink></li>
</ul>
<p><img src="@source/tp/cordova/ressources/remote_debug.png" alt="Remote"></p>
<ul>
<li>Patientez quelques secondes votre mobile doit apparaitre dans la liste.</li>
</ul>
<p><img src="@source/tp/cordova/ressources/remote_debug_show.png" alt="Remote">
Votre application (ainsi que vos Tabs Chrome) doit apparaitre dans la liste</p>
<ul>
<li>SÃ©lectionnez le Â« Inspect Â» qui correspond Ã  votre application.</li>
</ul>
<p><img src="@source/tp/cordova/ressources/inspect.png" alt="inspect"></p>
<p>Tenter des choses dans la Â« Console Â» qui vient de sâ€™ouvrir.</p>
<h2 id="ajouter-un-premier-plug-in" tabindex="-1"><a class="header-anchor" href="#ajouter-un-premier-plug-in" aria-hidden="true">#</a> Ajouter un premier plug-in</h2>
<p>Cordova fonctionne avec des plug-ins, Ã  chaque fois que vous voulez utiliser une fonctionnalitÃ© Â« native Â» de votre mobile vous devez installer un plug-in. Les plug-ins sont une combinaison de :</p>
<ul>
<li>Le code natif (Android, iOs, â€¦)</li>
<li>Un bridge (interface de communication) JavaScript.</li>
</ul>
<p>Les plug-ins sont disponibles en ligne sur le site :</p>
<ul>
<li><a href="https://cordova.apache.org/plugins/" target="_blank" rel="noopener noreferrer">Plugin Cordova<ExternalLinkIcon/></a></li>
</ul>
<p>Comme toujours, il est possible de trouver des plug-ins (non officel) sur Gitub par exemple, cependant il faut faire attention Ã  leur contenu (il vaux mieux Ãªtre prudentâ€¦).</p>
<h3 id="_1-ajouter-un-plug-in" tabindex="-1"><a class="header-anchor" href="#_1-ajouter-un-plug-in" aria-hidden="true">#</a> 1. Ajouter un plug-in</h3>
<p>Pour ajouter un plugin il suffit de faire :</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>cordova plugin <span class="token function">add</span> <span class="token operator">&lt;</span>monPlugin<span class="token operator">></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Pour lâ€™exemple nous allons ajouter le plug-in <code>cordova-plugin-camera</code></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>cordova plugin <span class="token function">add</span> cordova-plugin-camera
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Quelques secondes plus tard, votre application est <code>capable</code> dâ€™utiliser la CamÃ©ra de votre tÃ©lÃ©phone ğŸ‰ğŸ‰</p>
<h3 id="_2-utiliser-le-plug-in" tabindex="-1"><a class="header-anchor" href="#_2-utiliser-le-plug-in" aria-hidden="true">#</a> 2. Utiliser le plug-in</h3>
<p>Pour le test nous allons utiliser la console pour tester le plug-in :</p>
<ul>
<li>Lancer/Compiler lâ€™application Ã  nouveau sur votre mobile :</li>
</ul>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>cordova run android
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul>
<li>Lancer le Remote Debug sur Chrome.</li>
<li>Dans la console qui vient de sâ€™ouvrir, faites :</li>
</ul>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">cameraSuccess</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">cameraError</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
navigator<span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">getPicture</span><span class="token punctuation">(</span>cameraSuccess<span class="token punctuation">,</span> cameraError<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Le <code>{}</code> est la liste des options, tester quelques options <a href="https://www.npmjs.com/package/cordova-plugin-camera#module_camera.CameraOptions" target="_blank" rel="noopener noreferrer">disponible ici<ExternalLinkIcon/></a></p>
<h3 id="_3-modifier-le-code-de-demo" tabindex="-1"><a class="header-anchor" href="#_3-modifier-le-code-de-demo" aria-hidden="true">#</a> 3. Modifier le code de dÃ©mo</h3>
<p>Modifier le code de dÃ©monstration pour utiliser le plug-in de maniÃ¨re permanente.</p>
<ul>
<li>Ajouter un bouton.</li>
<li>Ajouter une fonction javascript pour dÃ©clencher la camÃ©ra</li>
<li>Ajouter un Ã©vÃ¨nement <code>onClick</code> sur le bouton que vous avez crÃ©Ã©</li>
</ul>
<h2 id="ajouter-un-second-plug-in" tabindex="-1"><a class="header-anchor" href="#ajouter-un-second-plug-in" aria-hidden="true">#</a> Ajouter un second plug-in</h2>
<p>Pour le second plug-in, nous allons ajouter un plug-in qui nâ€™a pas comme vocation directe dâ€™exposer un bridge en JavaScript. Nous allons ajouter un plug-in qui intÃ¨gre encore un peu plus une application hybride dans le systÃ¨me Android <code>cordova-plugin-headercolor</code></p>
<p>Le plug-in permet de :</p>
<ul>
<li>HeaderColor is a cordova plugin to change color of header in multitask view. Android devices.</li>
</ul>
<p>Les sources du plug-in sont <a href="https://github.com/tomloprod/cordova-plugin-headercolor" target="_blank" rel="noopener noreferrer">disponibles ici<ExternalLinkIcon/></a></p>
<h3 id="_1-ajouter-le-plug-in" tabindex="-1"><a class="header-anchor" href="#_1-ajouter-le-plug-in" aria-hidden="true">#</a> 1. Ajouter le plug-in</h3>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>cordova plugin <span class="token function">add</span> cordova-plugin-headercolor
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="_2-ajouter-la-configuration-du-plug-in" tabindex="-1"><a class="header-anchor" href="#_2-ajouter-la-configuration-du-plug-in" aria-hidden="true">#</a> 2. Ajouter la configuration du plug-in</h3>
<p>Ajouter dans le fichier <code>config.xml</code> lâ€™Ã©lÃ©ment suivant :</p>
<div class="language-xml ext-xml line-numbers-mode"><pre v-pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>preference</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>HeaderColor<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#2959cb<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="_3-lancer-l-application-pour-voir-le-changement" tabindex="-1"><a class="header-anchor" href="#_3-lancer-l-application-pour-voir-le-changement" aria-hidden="true">#</a> 3. Lancer lâ€™application pour voir le changement</h3>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>cordova run android
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></template>
