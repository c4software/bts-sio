<template><h1 id="ajouter-vuejs-2-0-dans-une-application-existante" tabindex="-1"><a class="header-anchor" href="#ajouter-vuejs-2-0-dans-une-application-existante" aria-hidden="true">#</a> Ajouter VueJS 2.0 dans une application existante</h1>
<p>Dans le cadre du TP, vous allez devoir Â« moderniser Â» une application simple. Lâ€™application Ã  migrer a Ã©tÃ© rÃ©alisÃ©e dans le cadre de la dÃ©monstration <em>uniquement</em>.</p>
<p>Lâ€™application existante est une Â« todo liste Â» codÃ©e en PHP + HTML.</p>
<details class="custom-container details"><summary>Table des matiÃ¨res</summary>
<nav class="table-of-contents"><ul><li><RouterLink to="#recuperation-et-installation-des-sources">RÃ©cupÃ©ration et installation des sources</RouterLink></li><li><RouterLink to="#liste-des-fonctionnalites">Liste des fonctionnalitÃ©s</RouterLink></li><li><RouterLink to="#stockage">Stockage</RouterLink></li><li><RouterLink to="#moderniser-avec-vuejs">Moderniser avec VueJS</RouterLink></li><li><RouterLink to="#creation-des-api">CrÃ©ation des API</RouterLink><ul><li><RouterLink to="#les-api">Les API</RouterLink></li><li><RouterLink to="#l-api-pour-lister-les-taches-liste-php">Lâ€™API pour lister les tÃ¢ches : liste.php</RouterLink></li><li><RouterLink to="#comment-proceder-pour-les-prochaines-api">Comment procÃ©der pour les prochaines API</RouterLink></li><li><RouterLink to="#l-api-de-creation-creation-php">Lâ€™API de crÃ©ation: creation.php</RouterLink></li><li><RouterLink to="#l-api-pour-marquer-une-tache-comme-terminee-terminer-php">Lâ€™API pour marquer une tÃ¢che comme terminÃ©e : terminer.php</RouterLink></li><li><RouterLink to="#l-api-de-suppression-suppression-php">Lâ€™API de suppression : suppression.php</RouterLink></li><li><RouterLink to="#valider-le-fonctionnement-postman">Valider le fonctionnement : Postman</RouterLink></li><li><RouterLink to="#optimisation-du-code">Optimisation du code</RouterLink></li></ul></li><li><RouterLink to="#integration-de-vuejs">IntÃ©gration de VueJS</RouterLink><ul><li><RouterLink to="#creation-de-la-structure-de-Â«-futur-Â»-projet">CrÃ©ation de la structure de Â« futur Â» projet</RouterLink></li><li><RouterLink to="#conversion-du-template-existant">Conversion du template existant</RouterLink></li><li><RouterLink to="#ajout-de-la-librairie-vuejs">Ajout de la librairie VueJS</RouterLink></li><li><RouterLink to="#migration-des-fonctionnalites">Migration des fonctionnalitÃ©s</RouterLink></li></ul></li><li><RouterLink to="#allez-plus-loin">Allez plus loin</RouterLink><ul><li><RouterLink to="#mettre-en-place-des-Â«-alertes-Â»">Mettre en place des Â« alertes Â»</RouterLink></li><li><RouterLink to="#ajouter-des-confirmations">Ajouter des confirmations</RouterLink></li><li><RouterLink to="#utiliser-l-api-de-partage">Utiliser l&#39;API de partage</RouterLink></li><li><RouterLink to="#ajouter-des-regles-de-reecriture">Ajouter des rÃ¨gles de rÃ©Ã©criture</RouterLink></li></ul></li></ul></nav>
</details>
<h2 id="recuperation-et-installation-des-sources" tabindex="-1"><a class="header-anchor" href="#recuperation-et-installation-des-sources" aria-hidden="true">#</a> RÃ©cupÃ©ration et installation des sources</h2>
<p>Avant de commencer Ã  travailler, il faut rÃ©cupÃ©rer le code source de lâ€™application existante. Le projet est disponible sur Github : <a href="https://github.com/c4software/php-todo/archive/v1.1.zip" target="_blank" rel="noopener noreferrer">tÃ©lÃ©charger les sources<ExternalLinkIcon/></a></p>
<ul>
<li>Faire Â« fonctionner Â» lâ€™application en local, une fois installÃ©e, celle-ci doit ressembler Ã  :</li>
</ul>
<p><img src="https://github.com/c4software/php-todo/raw/master/sample.png" alt="Exemple"></p>
<ul>
<li>Ã‰tudier le fonctionnement du code source actuel. (crÃ©er des tÃ¢ches, etc.)</li>
</ul>
<h2 id="liste-des-fonctionnalites" tabindex="-1"><a class="header-anchor" href="#liste-des-fonctionnalites" aria-hidden="true">#</a> Liste des fonctionnalitÃ©s</h2>
<p>VoilÃ  la liste des fonctionnalitÃ©s de lâ€™application existante :</p>
<ul>
<li>Liste des tÃ¢ches.</li>
<li>Ajout de tÃ¢che.</li>
<li>Suppression de tÃ¢che.</li>
<li>Marquer comme terminÃ© une tÃ¢che.</li>
</ul>
<h2 id="stockage" tabindex="-1"><a class="header-anchor" href="#stockage" aria-hidden="true">#</a> Stockage</h2>
<p>Lors de votre Ã©tude du code, vous avez dÃ» vous rendre compte que lâ€™application utilisait la variable <code>$_SESSION</code> pour stocker les Â« tÃ¢ches Â».</p>
<p>La SESSION Ã©tant non persistante, dans du vrai code il ne faut en <code>aucun cas</code> stocker des donnÃ©es comme des tÃ¢ches dedans (au risque de tout perdreâ€¦).</p>
<p>ğŸ” Au passage, regarder le fonctionnement de la SESSION en utilisant plusieurs navigateurs.</p>
<h2 id="moderniser-avec-vuejs" tabindex="-1"><a class="header-anchor" href="#moderniser-avec-vuejs" aria-hidden="true">#</a> Moderniser avec VueJS</h2>
<p>Dans ce TP nous allons parcourir les diffÃ©rentes Ã©tapes de la migration de lâ€™application (site web) Â« classique Â» en version Â« moderne Â» Ã  savoir avec VueJS.</p>
<h2 id="creation-des-api" tabindex="-1"><a class="header-anchor" href="#creation-des-api" aria-hidden="true">#</a> CrÃ©ation des API</h2>
<p>Quand on rÃ©alise une application Â« moderne Â», il est trÃ¨s difficile dâ€™Ã©chapper au client-serveur. Dans notre cas la partie serveur va Ãªtre rÃ©alisÃ©e en PHP, mais il est possible de la faire dans nâ€™importe quel langage. En entreprise vous serez souvent confrontÃ© Ã  du PHP/Java/Python/RoR. Mais la liste est infinie. Il est mÃªme possible de faire des API en Bashâ€¦ Bref le choix est infini.</p>
<h3 id="les-api" tabindex="-1"><a class="header-anchor" href="#les-api" aria-hidden="true">#</a> Les API</h3>
<p>Notre cas Ã©tant simple, chaque API sera en rÃ©alitÃ© un fichier PHP qui se chargera de faire lâ€™action voulue. Exemple :</p>
<ul>
<li>liste.php</li>
<li>creation.php</li>
<li>suppression.php</li>
<li>terminer.php</li>
</ul>
<p>Dans un nouveau dossier (version VueJS du site Web), ajouter un dossier <code>api</code> puis crÃ©er les <code>4</code> fichiers dans le dossier, nous les complÃ¨terons dans la suite du TP.</p>
<h3 id="l-api-pour-lister-les-taches-liste-php" tabindex="-1"><a class="header-anchor" href="#l-api-pour-lister-les-taches-liste-php" aria-hidden="true">#</a> Lâ€™API pour lister les tÃ¢ches : liste.php</h3>
<p>Lâ€™API Â« liste Â» doit retourner un JSON. Le JSON retournÃ© est une reprÃ©sentation au format texte des valeurs contenues dans la variable <code>$_SESSION[&quot;todos&quot;]</code>.</p>
<p>Exemple de retour :</p>
<div class="language-JSON ext-JSON line-numbers-mode"><pre v-pre class="language-JSON"><code>[
  {&quot;contenu&quot;: &quot;DÃ©mo&quot;, &quot;termine&quot;: true},
  {&quot;contenu&quot;: &quot;Exemple&quot;, &quot;termine&quot;: false}
]
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>VoilÃ  un exemple de code pour rÃ©aliser un fichier JSON en PHP :</p>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
  <span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"content-type: application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// VÃ©rifier si en $_SESSION["todos"] est bien un tableau</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"todos"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"todos"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token delimiter important">?></span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Rappel: Avant de pouvoir utiliser la session, vous devez faire un <code>session_start();</code></p>
<p>Câ€™est Ã  vous, rÃ©aliser votre premiÃ¨re API.</p>
<h3 id="comment-proceder-pour-les-prochaines-api" tabindex="-1"><a class="header-anchor" href="#comment-proceder-pour-les-prochaines-api" aria-hidden="true">#</a> Comment procÃ©der pour les prochaines API</h3>
<p>âœ‹ En tant que dÃ©veloppeur vous devez Ãªtre malin (et fainÃ©antsâ€¦). Pour Ã©crire les autres API, ne tentez pas de rÃ©inventer la roue, utiliser les exemples fournis dans le code actuel (dans le dossier <code>actions</code> par exemple).</p>
<h3 id="l-api-de-creation-creation-php" tabindex="-1"><a class="header-anchor" href="#l-api-de-creation-creation-php" aria-hidden="true">#</a> Lâ€™API de crÃ©ation: creation.php</h3>
<p>Lâ€™API Â« creation.php Â» va permettre la crÃ©ation de nouvelles Â« tÃ¢ches Â», une fois lâ€™ajout rÃ©alisÃ©, celle-ci doit retourner un JSON permettant de savoir dans votre application si le traitement sâ€™est bien passÃ©. Cette API ne doit fonctionner quâ€™en POST.</p>
<p>ParamÃ¨tre dâ€™entrÃ©e :</p>
<table>
<thead>
<tr>
<th>Nom</th>
<th style="text-align:center">Type</th>
<th style="text-align:right">MÃ©thode</th>
</tr>
</thead>
<tbody>
<tr>
<td>texte</td>
<td style="text-align:center">string</td>
<td style="text-align:right">POST</td>
</tr>
</tbody>
</table>
<p>Voici un exemple de code PHP :</p>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"content-type: application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Dans le cadre du traitement, vÃ©rifier si $_SESSION["todos"] est bien un tableau (is_arrayâ€¦)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"todos"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"todos"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"todos"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"texte"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"texte"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token variable">$todo</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"id"</span> <span class="token operator">=></span> <span class="token function">uniqid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"texte"</span> <span class="token operator">=></span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"texte"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"date"</span> <span class="token operator">=></span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"termine"</span> <span class="token operator">=></span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Sauvegarder dans la Session.</span>
  <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"todos"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$todo</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$todo</span><span class="token punctuation">;</span>
  <span class="token comment">// Afficher un JSON</span>
  <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"success"</span> <span class="token operator">=></span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
  <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"success"</span> <span class="token operator">=></span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token delimiter important">?></span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>Retour :</p>
<p>Par exemple :</p>
<div class="language-json ext-json line-numbers-mode"><pre v-pre class="language-json"><code><span class="token punctuation">{</span> <span class="token property">"success"</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Vous pouvez Ã©galement utiliser les codes de retour HTTP pour indique lâ€™Ã©tat du rÃ©sultat. <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status" target="_blank" rel="noopener noreferrer">Documentation<ExternalLinkIcon/></a></p>
<h3 id="l-api-pour-marquer-une-tache-comme-terminee-terminer-php" tabindex="-1"><a class="header-anchor" href="#l-api-pour-marquer-une-tache-comme-terminee-terminer-php" aria-hidden="true">#</a> Lâ€™API pour marquer une tÃ¢che comme terminÃ©e : terminer.php</h3>
<p>Lâ€™API Â« terminer.php Â» va changer lâ€™Ã©tat du flag Â« termine Â». Vous devez retourner un JSON permettant Ã  votre future application de sâ€™avoir si le traitement câ€™est bien dÃ©roulÃ©.</p>
<p>ParamÃ¨tre dâ€™entrÃ©e :</p>
<table>
<thead>
<tr>
<th>Nom</th>
<th style="text-align:center">Type</th>
<th style="text-align:right">MÃ©thode</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td style="text-align:center">string</td>
<td style="text-align:right">GET</td>
</tr>
</tbody>
</table>
<h3 id="l-api-de-suppression-suppression-php" tabindex="-1"><a class="header-anchor" href="#l-api-de-suppression-suppression-php" aria-hidden="true">#</a> Lâ€™API de suppression : suppression.php</h3>
<p>Lâ€™API Â« suppression Â» va permettre la suppression de la Â« tÃ¢che Â» passÃ©e en paramÃ¨tre, <strong><em>uniquement</em></strong> les tÃ¢ches dont le paramÃ¨tre <code>termine == true</code> peuvent Ãªtre terminÃ©e, dans tous les cas lâ€™API doit retourner un JSON permettant de savoir dans votre application si le traitement câ€™est bien passÃ©. Lâ€™API doit fonctionner en GET et en POST.</p>
<p>Contraintes :</p>
<ul>
<li>Lâ€™API doit fonctionner en GET et en POST.</li>
<li>Il est impossible de supprimer une tÃ¢che non terminÃ©e. <code>termine == true</code></li>
</ul>
<p>ParamÃ¨tre dâ€™entrÃ©e :</p>
<table>
<thead>
<tr>
<th>Nom</th>
<th style="text-align:center">Type</th>
<th style="text-align:right">MÃ©thode</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td style="text-align:center">string</td>
<td style="text-align:right">GET</td>
</tr>
</tbody>
</table>
<p>Par exemple :</p>
<div class="language-json ext-json line-numbers-mode"><pre v-pre class="language-json"><code><span class="token punctuation">{</span> <span class="token property">"success"</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="valider-le-fonctionnement-postman" tabindex="-1"><a class="header-anchor" href="#valider-le-fonctionnement-postman" aria-hidden="true">#</a> Valider le fonctionnement : Postman</h3>
<p>Pour tester vos traitements, vous avez la possibilitÃ© dâ€™utiliser le logiciel PostMan. PostMan va vous permettre de tester vos API simplement avec une interface graphique.</p>
<p>TÃ©lÃ©chargez-le <a href="https://www.getpostman.com/" target="_blank" rel="noopener noreferrer">ici<ExternalLinkIcon/></a></p>
<p>Une fois installÃ©, tester les appels Ã  vos APIs pour valider le bon fonctionnement</p>
<ul>
<li>Valider le fonctionnement Ã  chaque Ã©tape (CrÃ©ation, liste, terminer, suppression).</li>
</ul>
<h4 id="pour-l-api-creation" tabindex="-1"><a class="header-anchor" href="#pour-l-api-creation" aria-hidden="true">#</a> Pour lâ€™API crÃ©ation</h4>
<p>Petite subtilitÃ©, pour lâ€™API de crÃ©ation vous devez faire une requÃªte en POST. Vous devez donc rÃ©gler PostMan comme Ã§a :</p>
<p><img src="@source/tp/vuejs/ressources/postman.png" alt="PostMan DÃ©mo configuration Post"></p>
<h4 id="pour-les-autres-api" tabindex="-1"><a class="header-anchor" href="#pour-les-autres-api" aria-hidden="true">#</a> Pour les autres API</h4>
<p>Pour les autres API (sauf liste), vous allez devoir envoyer un <code>id</code> en paramÃ¨tre, avec PostMan câ€™est simple, voilÃ  la configuration que vous allez devoir faire :</p>
<p><img src="@source/tp/vuejs/ressources/postman_get.png" alt="Postman Demo GET"></p>
<h3 id="optimisation-du-code" tabindex="-1"><a class="header-anchor" href="#optimisation-du-code" aria-hidden="true">#</a> Optimisation du code</h3>
<p>AprÃ¨s avoir rÃ©alisÃ© vos 4 API, vous devez certainement avoir du code Â« dupliquÃ© Â». Modifier vos API pour crÃ©er des fonctions Â« utilitaires Â» permettant de rÃ©duire la duplication de code.</p>
<ul>
<li>Comment procÃ©dez-vous ?</li>
<li>Tester le fonctionnement Ã  nouveau.</li>
</ul>
<h2 id="integration-de-vuejs" tabindex="-1"><a class="header-anchor" href="#integration-de-vuejs" aria-hidden="true">#</a> IntÃ©gration de VueJS</h2>
<p>Maintenant que nous avons crÃ©Ã© les API nous allons pouvoir nous intÃ©resser Ã  la partie Â« Jâ€™intÃ¨gre VueJS Â».</p>
<p>Le dÃ©roulement des prochaines Ã©tapes va Ãªtre le suivant :</p>
<ul>
<li>IntÃ©grer la librairie VueJS dans le code existant.</li>
<li>CrÃ©er Â« un composant / objet Â» global qui va gÃ©rer lâ€™application.</li>
<li>Â« Convertir Â» le code existant en code Â« VueJS Â» (le Foreach par exemple).</li>
</ul>
<p>Ne vous inquiÃ©tez pas, tout est dÃ©taillÃ© dans les prochaines Ã©tapes :</p>
<p>Pour rÃ©aliser la suite du TP, nous allons avoir besoin des ressources suivantes :</p>
<ul>
<li><a href="https://vuejs.org" target="_blank" rel="noopener noreferrer">VueJS<ExternalLinkIcon/></a></li>
<li><a href="https://caniuse.com" target="_blank" rel="noopener noreferrer">CanIUse<ExternalLinkIcon/></a></li>
</ul>
<h3 id="creation-de-la-structure-de-Â«-futur-Â»-projet" tabindex="-1"><a class="header-anchor" href="#creation-de-la-structure-de-Â«-futur-Â»-projet" aria-hidden="true">#</a> CrÃ©ation de la structure de Â« futur Â» projet</h3>
<p>Maintenant que nous avons les API, nous allons pouvoir crÃ©er la structure de la Â« V2 Â». La suite du TP va dÃ©tailler le processus, mais voilÃ  le rendu du projet que vous allez obtenir :</p>
<p><img src="@source/tp/vuejs/ressources/projet_migration.png" alt="Structure"></p>
<p>Vous pouvez dÃ¨s Ã  prÃ©sent dÃ©placer les diffÃ©rents fichiers, pour obtenir la mÃªme chose (surtout pour le dossier <code>public</code>).</p>
<h3 id="conversion-du-template-existant" tabindex="-1"><a class="header-anchor" href="#conversion-du-template-existant" aria-hidden="true">#</a> Conversion du template existant</h3>
<p>La premiÃ¨re Ã©tape est de convertir le fichier <code>index.php</code>. Notre application 2.0, ne sera plus une application PHP classique, mais une application reposant sur un modÃ¨le Client &lt;-&gt; Serveur. Pour Ã§a vous devez procÃ©der Ã  quelques ajustements dans le site Internet :</p>
<ul>
<li>Supprimer le fichier index.php (il nâ€™est plus nÃ©cessaire).</li>
<li>DÃ©placer le template (dans le dossier template Ã  la racine).</li>
<li>Renommer le template que vous avez dÃ©placÃ© en Â« index.html Â», Ã§a va Ãªtre la base de notre application.</li>
</ul>
<h3 id="ajout-de-la-librairie-vuejs" tabindex="-1"><a class="header-anchor" href="#ajout-de-la-librairie-vuejs" aria-hidden="true">#</a> Ajout de la librairie VueJS</h3>
<p>Lâ€™ajout de la librairie VueJS est simple, il suffit dâ€™ajouter dans le Â« head Â» du index.html :</p>
<div class="language-html ext-html line-numbers-mode"><pre v-pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Valider le fonctionnement grÃ¢ce Ã  la Â« Console de DÃ©veloppement Â» de votre Navigateur (touche F12 en gÃ©nÃ©ral).</p>
<p>âš ï¸ Dans une optique dÃ©veloppement sÃ©curisÃ©, il est prÃ©fÃ©rable dâ€™intÃ©grer VueJS dans vos sources plutÃ´t que de Â« linker Â» directement depuis Internet.</p>
<ul>
<li>Comment validez-vous le fonctionnement ?</li>
<li>Changer les sources, pour intÃ©grer la librairie en local.</li>
</ul>
<h4 id="ajouter-un-script-pour-le-js" tabindex="-1"><a class="header-anchor" href="#ajouter-un-script-pour-le-js" aria-hidden="true">#</a> Ajouter un script pour le JS</h4>
<p>Ajouter avant la balise <code>&lt;/body&gt;</code> de lâ€™index.html un nouveau script <code>main.js</code>, il contiendra le code nÃ©cessaire au fonctionnement de notre site Web.</p>
<p>ğŸ˜… Vous devez bien Ã©videment crÃ©er le fichier <code>main.js</code>.</p>
<h4 id="declarer-votre-premier-composant" tabindex="-1"><a class="header-anchor" href="#declarer-votre-premier-composant" aria-hidden="true">#</a> DÃ©clarer votre premier composant</h4>
<p>Pour dÃ©clarer votre premier composant / objet VueJS, câ€™est simple il suffit de mettre dans le fichier <code>main.js</code> le code suivant :</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  el<span class="token operator">:</span> <span class="token string">".container"</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"DÃ©marrage TODO-APP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul>
<li>VÃ©rifier le bon fonctionnement en regardant la Â« Console de DÃ©veloppement Â». Le Â« log Â» est-il visible ?</li>
</ul>
<h3 id="migration-des-fonctionnalites" tabindex="-1"><a class="header-anchor" href="#migration-des-fonctionnalites" aria-hidden="true">#</a> Migration des fonctionnalitÃ©s</h3>
<p>Maintenant que nous avons notre base, nous allons pouvoir convertir lâ€™application. Pour cela nous allons procÃ©der par Ã©tape, chaque Ã©tape est directement liÃ©e aux diffÃ©rentes API que vous avez pu prÃ©cÃ©demment Ã©crire.</p>
<p>Lâ€™ensemble de lâ€™application va devenir Â« asynchrone Â», vous allez vite vous rendre compte que la migration va nÃ©cessiter beaucoup dâ€™Ajax. Pour faire nos appels, nous utiliserons lâ€™API Â« Fetch Â», celle-ci est intÃ©grÃ©e dans lâ€™ensemble des navigateurs rÃ©cents, le bon rÃ©flexe est quand mÃªme dâ€™aller voir le support de Fetch sur (<a href="https://caniuse.com/#search=fetch" target="_blank" rel="noopener noreferrer">Can i use<ExternalLinkIcon/></a>).</p>
<h4 id="decouverte-de-fetch" tabindex="-1"><a class="header-anchor" href="#decouverte-de-fetch" aria-hidden="true">#</a> DÃ©couverte de Fetch</h4>
<p>L'API Fetch fournit une interface JavaScript pour l'accÃ¨s et la manipulation des parties du pipeline HTTP, comme les requÃªtes et les rÃ©ponses. Cela fournit aussi une mÃ©thode globale fetch() qui procure un moyen facile et logique de rÃ©cupÃ©rer des ressources Ã  travers le rÃ©seau de maniÃ¨re asynchrone.</p>
<p>Ce genre de fonctionnalitÃ© Ã©tait auparavant rÃ©alisÃ© avec XMLHttpRequest. Fetch fournit une meilleure alternative qui peut Ãªtre utilisÃ©e facilement par dâ€™autres technologies comme Service Workers. Fetch fournit aussi un endroit unique et logique pour la dÃ©finition d'autres concepts liÃ©s Ã  HTTP comme CORS et les extensions d'HTTP.</p>
<p>(Source: MDM)</p>
<p>Le support de l'API Fetch peut Ãªtre dÃ©tectÃ© en vÃ©rifiant l'existence de Headers, Request, Response ou fetch() sur la portÃ©e de Window ou de Worker.
Par exemple, vous pouvez faire cela dans votre script:</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>fetch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Le support de Fetch est prÃ©sent</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// GÃ©rer le cas du non-support de fetch.</span>
  <span class="token comment">// Pour rÃ©duire le nombre de cas possible vous pouvez ajouter : https://github.github.io/fetch/ Ã  votre projet</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Voici un EXEMPLE dâ€™utilisation de Fetch :</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"api/liste.php"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> method<span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span> credentials<span class="token operator">:</span> <span class="token string">"same-origin"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// On dÃ©code le JSON, et on continue</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// Votre retour est ICI</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"RÃ©cupÃ©ration impossible: "</span> <span class="token operator">+</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>âš ï¸ Que veux dire <code>credentials: 'same-origin'</code>? Par dÃ©faut, Fetch nâ€™utilise pas les Cookies, vous pouvez forcer lâ€™utilisation des cookies en indiquant <code>credentials: 'same-origin'</code>. Si vous ne le faites pas vos <code>$_SESSION</code> ne seront pas sauvegardÃ©es âš ï¸</p>
<p>Tester le code prÃ©cÃ©dent dans :</p>
<ul>
<li>Tester dÃ¨s Ã  prÃ©sent cet appel dans la Â« Console dÃ©veloppeur Â»</li>
</ul>
<p>Pour aller plus loin dans lâ€™utilisation de Fetch, je vous recommande la lecture de <a href="https://developer.mozilla.org/fr/docs/Web/API/Fetch_API/Using_Fetch" target="_blank" rel="noopener noreferrer">la documentation complÃ¨te (gestion des headers, paramÃ¨tres, mode, etc.)<ExternalLinkIcon/></a></p>
<h4 id="liste-des-taches" tabindex="-1"><a class="header-anchor" href="#liste-des-taches" aria-hidden="true">#</a> Liste des tÃ¢ches</h4>
<p>La liste des tÃ¢ches est chargÃ©e dÃ¨s lâ€™arrivÃ©e sur la page Â« principale Â». Vous devez donc Ã©crire du code dans lâ€™Ã©vÃ¨nement Â« beforeMount Â» (pour rappel nâ€™hÃ©sitez pas Ã  consulter le <a href="https://vuejs.org/images/lifecycle.png" target="_blank" rel="noopener noreferrer">cycle de vie des composants<ExternalLinkIcon/></a>)</p>
<ul>
<li>Dans le fichier main.js, ajouter Ã  lâ€™objet Vue <code>beforeMount</code></li>
</ul>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  el<span class="token operator">:</span> <span class="token string">".container"</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"DÃ©marrage TODO-APP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Pour l'instant nous allons mettre le code ici</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul>
<li>Ajouter le code suivant dans la partie <code>beforeMount</code></li>
</ul>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"api/liste.php"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> method<span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span> credentials<span class="token operator">:</span> <span class="token string">"same-origin"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>taches <span class="token operator">=</span> response<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"RÃ©cupÃ©ration impossible: "</span> <span class="token operator">+</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul>
<li>Initialiser la variable taches dans lâ€™objet VueJS, Exemple :</li>
</ul>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  el<span class="token operator">:</span> <span class="token string">'.container'</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> taches<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>â€¦<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul>
<li>Ajouter lâ€™affichage dans le Â« template Â». Dans la page HTML vous allez devoir utiliser lâ€™attribut <code>v-for</code>. Exemple :</li>
</ul>
<div class="language-html ext-html line-numbers-mode"><pre v-pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tache in taches<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{tache.texte}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Adapter lâ€™exemple prÃ©cÃ©dant pour afficher les tÃ¢ches comme ils lâ€™Ã©taient dans la page en version PHP.</p>
<p><a href="https://fr.vuejs.org/v2/guide/list.html" target="_blank" rel="noopener noreferrer">Plus de dÃ©tail sur la partie Â« rendu des listes Â»<ExternalLinkIcon/></a></p>
<ul>
<li>Lâ€™affichage est-il le mÃªme ?</li>
<li>Comment gÃ©rer le cas du chargement ? (dans le monde rÃ©el Internet peut-Ãªtre lentâ€¦)</li>
<li>Comment gÃ©rer le cas de la liste vide ?</li>
</ul>
<h4 id="organisation-du-code" tabindex="-1"><a class="header-anchor" href="#organisation-du-code" aria-hidden="true">#</a> Organisation du code</h4>
<p>DÃ©placer le code actuellement dans <code>beforeMount</code> dans une nouvelle mÃ©thode appelÃ©e <code>recupererListe</code> :</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token punctuation">[</span>â€¦<span class="token punctuation">]</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">recupererListe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// â€¦</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Remplacer le code dans le <code>beforeMount</code> pour appeler la mÃ©thode <code>recupererListe</code>.</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  el<span class="token operator">:</span> <span class="token string">".container"</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"DÃ©marrage TODO-APP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">recupererListe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="ajout-d-une-tache" tabindex="-1"><a class="header-anchor" href="#ajout-d-une-tache" aria-hidden="true">#</a> Ajout dâ€™une tÃ¢che</h4>
<p>Maintenant que la liste est affichÃ©e, vous allez pouvoir gÃ©rer le cas de lâ€™ajout dâ€™une nouvelle tÃ¢che. Lâ€™ajout va Ã©galement Ãªtre fait via un appel Ajax.</p>
<ul>
<li>CrÃ©er une mÃ©thode JavaScript, rÃ©alisant lâ€™appel de lâ€™API.</li>
</ul>
<p>âš ï¸ Attention: Lâ€™utilisateur devant Ãªtre prÃ©venu de lâ€™aspect obligatoire du contenu, vous devez rendre la saisie obligatoire (contrÃ´le de saisie, et/ou via <a href="https://sweetalert.js.org/guides/#cdn" target="_blank" rel="noopener noreferrer">librairie Sweetalert<ExternalLinkIcon/></a>) âš ï¸</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token punctuation">[</span>â€¦<span class="token punctuation">]</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">ajout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Pourquoi pas une variable dans Â« data Â», tout simplement pour simplifier Â« le TP Â».</span>
      <span class="token keyword">var</span> contenu <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"texte"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>contenu <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">swal</span><span class="token punctuation">(</span><span class="token string">"Oops"</span><span class="token punctuation">,</span><span class="token string">"Vous devez spÃ©cifier du texteâ€¦"</span> <span class="token punctuation">,</span> <span class="token string">"error"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token comment">// Appel de lâ€™API avec Fetch (Ajax)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token punctuation">[</span>â€¦<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul>
<li>CrÃ©er lâ€™appel Ã  lâ€™API</li>
</ul>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">var</span> form <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
form<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"texte"</span><span class="token punctuation">,</span> contenu<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"api/creation.php"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  method<span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>
  body<span class="token operator">:</span> form<span class="token punctuation">,</span>
  credentials<span class="token operator">:</span> <span class="token string">"same-origin"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">recupererListe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// GÃ©rer le cas d'erreur. Par exemple, afficher une Sweetalert pour le client.</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"RÃ©cupÃ©ration impossible: "</span> <span class="token operator">+</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><ul>
<li>Rafraichir la liste des tÃ¢ches, pour Ã§a vous allez crÃ©er une 2nd mÃ©thode qui rÃ©alise lâ€™appel Ajax de rÃ©cupÃ©ration de la liste. Une fois cette mÃ©thode faite, appeler la dans la partie <code>// traiter le retour</code>.</li>
<li>Optimiser votre code en remplaÃ§ant le code dans le <code>beforeMount</code> par un appel Ã  la mÃ©thode que vous avez crÃ©Ã©e.</li>
</ul>
<p>Votre objet VueJS doit ressembler Ã  quelque chose comme Ã§a :</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  el<span class="token operator">:</span> <span class="token string">".container"</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"DÃ©marrage TODO-APP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    taches<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">recupererListe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">ajout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Votre code</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">recupererListe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Votre code</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><ul>
<li>Appel de votre code dans le template. Maintenant que votre code est prÃªt, vous allez pouvoir lâ€™appeler depuis votre template. Pour faire Ã§a, vous allez utiliser <a href="https://vuejs.org/v2/guide/events.html" target="_blank" rel="noopener noreferrer">la gestion des Ã©vÃ¨nements de VueJS<ExternalLinkIcon/></a> Exemple :</li>
</ul>
<div class="language-html ext-html line-numbers-mode"><pre v-pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">@submit.prevent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ajout()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul>
<li>Tester votre code.</li>
<li>Tester lâ€™ajout de tÃ¢che.</li>
<li>Tenter dâ€™injecter du code. Que se passe-t-il ?</li>
</ul>
<h4 id="marquer-une-tache-comme-terminee" tabindex="-1"><a class="header-anchor" href="#marquer-une-tache-comme-terminee" aria-hidden="true">#</a> Marquer une tÃ¢che comme terminÃ©e</h4>
<p>Pour marquer une tÃ¢che comme terminÃ©e, vous allez devoir appeler lâ€™api Â« terminer.php Â». Cette API doit Ãªtre appelÃ©e lors du clic sur lâ€™icÃ´ne qui a comme class Â« oi oi-check Â».</p>
<ul>
<li>Utilisez-le <a href="https://fr.vuejs.org/v2/guide/events.html" target="_blank" rel="noopener noreferrer">v-on:click<ExternalLinkIcon/></a></li>
<li>Remplacer :</li>
</ul>
<div class="language-html ext-html line-numbers-mode"><pre v-pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./actions/done.php?id={id}<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-success<span class="token punctuation">"</span></span>
  <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>oi oi-check<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span>
<span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Par</p>
<div class="language-html ext-html line-numbers-mode"><pre v-pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>oi oi-check<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>terminer(todo.id)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul>
<li>DÃ©clarer la mÃ©thode Â« terminer Â» dans votre objet VueJS. Faites lâ€™appel Ã  votre API.</li>
<li>Lâ€™objet VueJS doit maintenant ressemble Ã  quelque chose comme Ã§a :</li>
</ul>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  el<span class="token operator">:</span> <span class="token string">".container"</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"DÃ©marrage TODO-APP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    taches<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">recupererListe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">ajout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Votre code</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">recupererListe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Votre code</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">terminer</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Votre code</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ul>
<li>Ajouter le <a href="https://fr.vuejs.org/v2/guide/conditional.html" target="_blank" rel="noopener noreferrer">v-if<ExternalLinkIcon/></a> nÃ©cessaire Ã  la rÃ¨gle suivante Â« uniquement les tÃ¢ches non terminÃ©es peuvent Ãªtre marquÃ©es comme terminÃ©es Â»</li>
<li>Tester le fonctionnement.</li>
<li>Valider que seulement les tÃ¢ches marquÃ©es comme Â« non terminÃ©es Â» peuvent Ãªtre terminÃ©es.</li>
</ul>
<h4 id="suppression-d-une-tache" tabindex="-1"><a class="header-anchor" href="#suppression-d-une-tache" aria-hidden="true">#</a> Suppression dâ€™une tÃ¢che</h4>
<p>La suppression dâ€™une tÃ¢che est trÃ¨s similaire Ã  lâ€™action Â« terminer.php Â». Je vous laisse appliquer la mÃ©thodologie prÃ©cÃ©dente.</p>
<p>Ne pas oublier la rÃ¨gle de gestion : Â« Une tÃ¢che non marquÃ©e comme terminÃ©e ne peut Ãªtre supprimÃ©e. Â»</p>
<p>Lâ€™objet doit maintenant ressembler Ã  (Le code que vous avez Ã©crit en moins):</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  el<span class="token operator">:</span> <span class="token string">".container"</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"DÃ©marrage TODO-APP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    taches<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">recupererListe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">ajout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Votre code</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">recupererListe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Votre code</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">terminer</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Votre code</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">supprimer</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Votre code</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h4 id="optimisation" tabindex="-1"><a class="header-anchor" href="#optimisation" aria-hidden="true">#</a> Optimisation</h4>
<p>Comme vous lâ€™avez certainement constatÃ©, les deux derniÃ¨res actions sont trÃ¨s similaires. Faites fusionner les deux actions en ajoutant par exemple un paramÃ¨tre Â« action Â». Ce paramÃ¨tre vous permettra de savoir dans quel cas vous vous trouvez, je vous laisse Ã©crire le code.</p>
<h2 id="allez-plus-loin" tabindex="-1"><a class="header-anchor" href="#allez-plus-loin" aria-hidden="true">#</a> Allez plus loin</h2>
<p>Quelques pistes pour aller plus loin dans le code :</p>
<h3 id="mettre-en-place-des-Â«-alertes-Â»" tabindex="-1"><a class="header-anchor" href="#mettre-en-place-des-Â«-alertes-Â»" aria-hidden="true">#</a> Mettre en place des Â« alertes Â»</h3>
<p>Vous n'avez certainement pas mis les messages en cas Â« d'erreur Â» comme indiquÃ© aux diffÃ©rentes Ã©tapes, comme par exemple :</p>
<ul>
<li>En cas d'absence de texte au moment de la validation du formulaire.</li>
<li>En cas d'erreur de rÃ©cupÃ©ration des TODO par l'API.</li>
</ul>
<p>Pour Ã§a vous pouvez utiliser <a href="https://sweetalert.js.org/guides/#cdn" target="_blank" rel="noopener noreferrer">librairie Sweetalert<ExternalLinkIcon/></a>.</p>
<h3 id="ajouter-des-confirmations" tabindex="-1"><a class="header-anchor" href="#ajouter-des-confirmations" aria-hidden="true">#</a> Ajouter des confirmations</h3>
<p>Ajout des confirmations avant les actions Â« marquer comme terminÃ© Â» et lâ€™action suppression.</p>
<h3 id="utiliser-l-api-de-partage" tabindex="-1"><a class="header-anchor" href="#utiliser-l-api-de-partage" aria-hidden="true">#</a> Utiliser l'API de partage</h3>
<p>Depuis quelques mois Chrom(e|ium) propose une nouvelle API nommÃ©e Â« Web Share Api Â», Cette API permet de dÃ©clencher Â« le Partage Â» dâ€™une information en utilisant les possibilitÃ©s natives du TÃ©lÃ©phone. Comme cette API nâ€™est disponible que sur un tÃ©lÃ©phone et uniquement en HTTPS vous devez tester si celle-ci est prÃ©sente avec</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>share<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><a href="https://caniuse.com/#search=Web%20Share%20Api" target="_blank" rel="noopener noreferrer">Voir le support de Share<ExternalLinkIcon/></a></p>
<p>Mais comme nous sommes avec VueJS nous allons gÃ©rer Ã§a avec le MVVM (ModÃ¨le Vue, Vue-ModÃ¨le), Ã§a va nous permettre dâ€™injecter une variable Ã  la crÃ©ation de lâ€™objet <code>app</code> pour connaitre si le partage est disponible. Exemple :</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  el<span class="token operator">:</span> <span class="token string">'.container'</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"DÃ©marrage TODO-APP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
      taches<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      isShare<span class="token operator">:</span> navigator<span class="token punctuation">.</span>share <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>â€¦<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Une fois fait, vous avez une variable <code>isShare</code> qui sera <code>True</code> Ou <code>False</code> en fonction du support du navigateur. Maintenant que le boolÃ©en est disponible vous pouvez ajouter un Ã©lÃ©ment cliquable pour dÃ©clencher lâ€™action (prendre exemple sur la suppression ou le marquer comme terminÃ©). Exemple de code pour dÃ©clencher le partage :</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token punctuation">[</span>â€¦<span class="token punctuation">]</span>
methods<span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token function">share</span><span class="token punctuation">(</span><span class="token parameter">texte</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      navigator<span class="token punctuation">.</span><span class="token function">share</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        title<span class="token operator">:</span> <span class="token string">'VueJS-Todo'</span><span class="token punctuation">,</span>
        text<span class="token operator">:</span> texte<span class="token punctuation">,</span>
        url<span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
          <span class="token comment">// TODO</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
          <span class="token comment">// TODO</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span>â€¦<span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>Câ€™est Ã  vous !</p>
<h3 id="ajouter-des-regles-de-reecriture" tabindex="-1"><a class="header-anchor" href="#ajouter-des-regles-de-reecriture" aria-hidden="true">#</a> Ajouter des rÃ¨gles de rÃ©Ã©criture</h3>
<p>Ajouter des rÃ¨gles de rÃ©Ã©criture via un fichier .htaccess</p>
<p>Le fichier <code>.htaccess</code> exemple :</p>
<div class="language-apacheconf ext-apacheconf line-numbers-mode"><pre v-pre class="language-apacheconf"><code><span class="token directive-inline property">RewriteEngine</span> On
<span class="token directive-inline property">RewriteRule</span><span class="token regex"> ^api/ajouter$</span> api/ajouter.php <span class="token directive-flags keyword">[L,QSA]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Une fois les rÃ¨gles de rÃ©Ã©criture faites, modifier les diffÃ©rents chemins (appel dâ€™API) dans votre fichier JavaScript.</p>
</template>
