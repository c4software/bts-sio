<template><h1 id="prise-en-main-structure-mvc" tabindex="-1"><a class="header-anchor" href="#prise-en-main-structure-mvc" aria-hidden="true">#</a> Prise en main structure MVC</h1>
<p>Dans ce TP, nous allons prendre en main <RouterLink to="/tp/php/mvc/tp1.html">la structure de code prÃ©sente ici</RouterLink>.</p>
<details class="custom-container details"><summary>Sommaire</summary>
<nav class="table-of-contents"><ul><li><RouterLink to="#introduction">Introduction</RouterLink></li><li><RouterLink to="#le-projet">Le projet</RouterLink></li><li><RouterLink to="#la-structure">La structure</RouterLink><ul><li><RouterLink to="#le-modele">Le ModÃ¨le</RouterLink></li><li><RouterLink to="#la-vue">La Vue</RouterLink></li><li><RouterLink to="#le-controleur">Le ContrÃ´leur</RouterLink></li><li><RouterLink to="#le-routeur">Le Routeur</RouterLink></li><li><RouterLink to="#vous-souhaitez-plus-de-detail">Vous souhaitez plus de dÃ©tail ?</RouterLink></li></ul></li><li><RouterLink to="#recuperer-le-code-source-d-exemple">RÃ©cupÃ©rer le code source d&#39;exemple</RouterLink><ul><li><RouterLink to="#globalement">Globalement</RouterLink></li><li><RouterLink to="#la-configuration">La configuration</RouterLink></li><li><RouterLink to="#telecharger-le-code-source">TÃ©lÃ©charger le code source</RouterLink></li></ul></li><li><RouterLink to="#faire-fonctionner-le-code">Faire fonctionner le code</RouterLink></li><li><RouterLink to="#modifier-la-page-Â«-home-Â»">Modifier la page Â« Home Â»</RouterLink></li><li><RouterLink to="#creer-la-page-Â«-about-Â»">CrÃ©er la page Â« About Â»</RouterLink><ul><li><RouterLink to="#creer-la-methode">CrÃ©er la mÃ©thode</RouterLink></li><li><RouterLink to="#creer-la-vue-page">CrÃ©er la vue / page</RouterLink></li><li><RouterLink to="#creer-la-route">CrÃ©er la route</RouterLink></li></ul></li><li><RouterLink to="#place-au-projet-Â«-la-todo-list-Â»">Place au projet Â« La TODO list Â»</RouterLink><ul><li><RouterLink to="#bootstrap">Bootstrap</RouterLink></li><li><RouterLink to="#modelisation-de-la-base-de-donnees">ModÃ©lisation de la base de donnÃ©es</RouterLink></li><li><RouterLink to="#creer-le-modele">CrÃ©er le modÃ¨le</RouterLink></li><li><RouterLink to="#modifier-le-constructeur">Modifier le constructeur</RouterLink></li><li><RouterLink to="#creer-la-methode-Â«-marquercommetermine-Â»">CrÃ©er la mÃ©thode Â« marquerCommeTermine() Â»</RouterLink></li><li><RouterLink to="#initialiser-la-base-de-donnees">Initialiser la base de donnÃ©es</RouterLink></li><li><RouterLink to="#creer-le-controleur">CrÃ©er le contrÃ´leur</RouterLink></li><li><RouterLink to="#definir-les-routes-dans-le-routeur">DÃ©finir les routes dans le routeur</RouterLink></li><li><RouterLink to="#ajouter-le-constructeur-construct">Ajouter le constructeur __construct()</RouterLink></li><li><RouterLink to="#la-methode-liste">La mÃ©thode liste()</RouterLink></li><li><RouterLink to="#le-template-de-la-page-liste">Le template de la page liste</RouterLink></li><li><RouterLink to="#la-methode-ajouter-texte">La mÃ©thode ajouter($texte = &#39;&#39;)</RouterLink></li><li><RouterLink to="#la-methode-terminer-id">La mÃ©thode terminer($id = &#39;&#39;)</RouterLink></li><li><RouterLink to="#la-methode-supprimer-id">La mÃ©thode supprimer($id = &#39;&#39;)</RouterLink></li><li><RouterLink to="#un-serveur-de-dev">Un serveur de dev ?</RouterLink></li><li><RouterLink to="#evolution-0">Ã‰volution 0</RouterLink></li><li><RouterLink to="#evolution-1">Ã‰volution 1</RouterLink></li><li><RouterLink to="#evolution-2">Ã‰volution 2</RouterLink></li><li><RouterLink to="#evolution-3">Ã‰volution 3</RouterLink></li><li><RouterLink to="#evolution-4">Ã‰volution 4</RouterLink></li></ul></li></ul></nav>
</details>
<h2 id="introduction" tabindex="-1"><a class="header-anchor" href="#introduction" aria-hidden="true">#</a> Introduction</h2>
<p>Comme prÃ©cisÃ© dans le cours et dans nos Ã©changes, la structure Â« MVC Â» est proposÃ©e ici comme phase transitoire entre votre code PHP de premiÃ¨re annÃ©e et du Laravel que l'on peut retrouver en entreprise. En effet, mÃªme si la structure MVC a Ã©tÃ© crÃ©Ã©e avec la prise en compte de contrainte de sÃ©curitÃ© elle nâ€™est en aucun cas dimensionnÃ©e pour rÃ©aliser un site client avec plusieurs centaines d'utilisateurs.</p>
<ul>
<li><RouterLink to="/cheatsheets/poo/">Aide mÃ©moire Programmation OrientÃ©e Objet</RouterLink></li>
</ul>
<div class="custom-container tip"><p class="custom-container-title">C'est important</p>
<p>Le point d'introduction est important. Savoir justifier d'une solution est tout aussi important que la solution en elle-mÃªme. Si vous dÃ©cider dÃ©cider d'utiliser ma structure dans d'autres dÃ©veloppements vous devez le faire avec conviction et pas juste Â« parceque Â».</p>
<p>Ceci Ã©tant dit, nous pouvons continuer ğŸš€ !</p>
</div>
<h2 id="le-projet" tabindex="-1"><a class="header-anchor" href="#le-projet" aria-hidden="true">#</a> Le projet</h2>
<p>Si vous avez dÃ©jÃ  testÃ© de nouvelles technologies, il existe un type de projet qui permet Â« de prendre en main Â» facilement du code inconnu. Ce type de projet est une TODO List.</p>
<p>Je vous propose donc de rÃ©aliser une TODO List en utilisant la structure MVC.</p>
<p><em>VoilÃ  ce que nous allons rÃ©aliser :</em></p>
<p><img src="@source/tp/php/mvc/res/liste.png" alt="Le projet"></p>
<h2 id="la-structure" tabindex="-1"><a class="header-anchor" href="#la-structure" aria-hidden="true">#</a> La structure</h2>
<p>La structure de code MVC reprend les bases des frameworks modernes types Laravel. C'est-Ã -dire un dÃ©coupage Â« MVC Â», le dÃ©coupage MVC signifie :</p>
<ul>
<li><strong>M</strong>odÃ¨le</li>
<li><strong>V</strong>ue</li>
<li><strong>C</strong>ontrÃ´leur</li>
</ul>
<p><img src="@source/tp/php/mvc/res/mvc.png" alt="MVC"></p>
<h3 id="le-modele" tabindex="-1"><a class="header-anchor" href="#le-modele" aria-hidden="true">#</a> Le ModÃ¨le</h3>
<p>Le modÃ¨le reprÃ©sente la couche de votre application qui va manipuler les donnÃ©es. ConcrÃ¨tement c'est celle-ci qui va parler en SQL avec votre moteur de base de donnÃ©es.</p>
<p>Vous trouverez dans celle-ci <strong>autant de mÃ©thodes que nÃ©cessaire</strong>, vous pouvez <em>(et Ã  mon avis vous devez)</em> spÃ©cialiser vos modÃ¨les aux diffÃ©rentes tables prÃ©sentes dans votre projet.</p>
<p>Par exemple si nous avons la base de donnÃ©es suivante :</p>
<p><img src="@source/tp/php/mvc/res/mcd_exemple.jpeg" alt="Exemple MCD"></p>
<p>Nous devrions crÃ©er au minimum <em>3 modÃ¨les</em> :</p>
<ul>
<li>Client</li>
<li>BonDeCommande</li>
<li>Produit</li>
</ul>
<p>Avec Ã  chaque fois des mÃ©thodes spÃ©cifiques exemple, nous pourrions avoir</p>
<table>
<thead>
<tr>
<th style="text-align:left">ModÃ¨le</th>
<th style="text-align:left">MÃ©thodes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Client</td>
<td style="text-align:left"><code>CreerClient()</code>, <code>ModifierClient()</code>, <code>SupprimerClient()</code></td>
</tr>
<tr>
<td style="text-align:left">BonDeCommande</td>
<td style="text-align:left"><code>CreerBdc()</code>, <code>ModifierBdc()</code>, <code>SupprimerBdc()</code></td>
</tr>
<tr>
<td style="text-align:left">Produit</td>
<td style="text-align:left"><code>CreerProduit()</code>, <code>ModifierProduit()</code>, <code>SupprimerProduit()</code></td>
</tr>
</tbody>
</table>
<div class="custom-container danger"><p class="custom-container-title">STOP ! Ce qu'il faut retenir</p>
<p>Ce qu'il faut retenir c'est :</p>
<ul>
<li>Autant d'objets que de tables.</li>
<li>Des mÃ©thodes spÃ©cifiques aux actions Ã  faire dans la table.</li>
</ul>
</div>
<div class="custom-container tip"><p class="custom-container-title">CRUD</p>
<p>Ce genre d'objet s'appelle un CRUD (Create, Update, Delete). C'est une structure que nous retrouverons trÃ¨s souvent. Vous allez voir que c'est tellement courant qu'en gÃ©nÃ©ral ils sont Ã©crits automatiquement par le Framework.</p>
<iframe src="https://giphy.com/embed/11ISwbgCxEzMyY" width="480" height="360" frameBorder="0" class="giphy-embed" allowFullScreen></iframe>
</div>
<h3 id="la-vue" tabindex="-1"><a class="header-anchor" href="#la-vue" aria-hidden="true">#</a> La Vue</h3>
<p>La vue vous connaissez! Ici rien de nouveau. Le <code>V</code> de MVC c'est juste la reprÃ©sentation graphique de ce que vous souhaitez afficher (en HTML + CSS + JavaScript).</p>
<p>Cependant par rapport Ã  vos premiers dÃ©veloppements nous allons dÃ©couper au maximum le code HTML en diffÃ©rents fichiers ; Objectif Ã©viter le code dupliquÃ© en utilisant une organisation qui ressemblera Ã  :</p>
<p><img src="@source/tp/php/mvc/res/parties.png" alt="DÃ©coupage"></p>
<div class="custom-container tip"><p class="custom-container-title">L'objectif ?</p>
<ul>
<li>Ã‰viter le code dupliquÃ©.</li>
<li>Faciliter la modification.</li>
<li>Se concentrer sur la partie du code Â« MÃ©tier Â» de la page en cours.</li>
</ul>
</div>
<h3 id="le-controleur" tabindex="-1"><a class="header-anchor" href="#le-controleur" aria-hidden="true">#</a> Le ContrÃ´leur</h3>
<p>Et le contrÃ´leur dans tout Ã§a ? Et bien le contrÃ´leur va assembler :</p>
<ul>
<li>Votre modÃ¨le (l'accÃ¨s aux donnÃ©es).</li>
<li>Votre Vue (l'affichage).</li>
</ul>
<p>Le code va prendre les demandes des clients Â« appel HTTP Â» rÃ©aliser le traitement en base de donnÃ©es et afficher Â« la vue Â» rÃ©sultat au client.</p>
<p>Comme pour le modÃ¨le, le contrÃ´leur est un objet qui doit possÃ©der idÃ©alement autant de mÃ©thode que de page (et peut-Ãªtre plus).</p>
<h3 id="le-routeur" tabindex="-1"><a class="header-anchor" href="#le-routeur" aria-hidden="true">#</a> Le Routeur</h3>
<p>Nous l'avons vu en cours, en plus du MVC classique, nous allons ajouter une derniÃ¨re brique Â« essentiel Â» au bon fonctionnement et Ã  la maintenance de votre site Internet. Cette brique est nommÃ©e un <strong>Routeur</strong>.</p>
<p>Le routeur va contenir la dÃ©claration des Â« liens Â» de votre site Internet afin de les aiguiller vers la bonne fonctionnalitÃ© dans votre contrÃ´leur.</p>
<p>Nous pouvons schÃ©matiser le fonctionnement :</p>
<p><img src="@source/tp/php/mvc/res/routeur.png" alt="IntÃ©gration du routeur"></p>
<div class="custom-container tip"><p class="custom-container-title">Vous Ãªtes ici ?</p>
<p>Appeler-moi nous allons discuter un peu de cette architecture, qui est la base de presque l'ensemble des frameworks modernes (Laravel, VueJS, React â€¦)</p>
</div>
<h3 id="vous-souhaitez-plus-de-detail" tabindex="-1"><a class="header-anchor" href="#vous-souhaitez-plus-de-detail" aria-hidden="true">#</a> Vous souhaitez plus de dÃ©tail ?</h3>
<p>L'idÃ©e ici Ã©tait de rappeler les bases, si vous souhaitez plus de dÃ©tail sur l'architecture MVC que je vous propose <RouterLink to="/tp/php/mvc/tp1.html">rendez-vous ici</RouterLink></p>
<h2 id="recuperer-le-code-source-d-exemple" tabindex="-1"><a class="header-anchor" href="#recuperer-le-code-source-d-exemple" aria-hidden="true">#</a> RÃ©cupÃ©rer le code source d'exemple</h2>
<p>Un peu comme pour un projet Laravel, nous n'allons pas partir de 0 ! Vous allez partir d'un code initial qui vous servira de base de travail.</p>
<p>Le code en question est Â« vide Â», il s'agit uniquement d'une structure que <strong>vous devez</strong> respecter. Un peu comme en entreprise vous vous intÃ©grez dans une Ã©quipe, je vous propose ici de respecter quelques rÃ¨gles qui sont des standards du dÃ©veloppement.</p>
<p>Comme indiquÃ© en introduction, la structuration d'un dÃ©veloppement est aussi importante que le dÃ©veloppement en
lui-mÃªme. C'est pour Ã§a qu'avant mÃªme de dÃ©velopper il est important de prendre en main la structure des dossiers et
fichiers proposÃ©s dans le code prÃ©sentÃ© en exemple.</p>
<p>La structure de base en termes de dossier ressemble Ã  :</p>
<p><img src="@source/tp/php/mvc/res/structure_dossiers.png" alt="Structure des dossiers"></p>
<div class="custom-container tip"><p class="custom-container-title">CompliquÃ© ?</p>
<p>Pas d'inquiÃ©tude, pas de stress ! nous allons voir ensemble comment prendre en main le code.</p>
</div>
<h3 id="globalement" tabindex="-1"><a class="header-anchor" href="#globalement" aria-hidden="true">#</a> Globalement</h3>
<p>Le code prÃ©sent utilise diffÃ©rents aspects du dÃ©veloppement objet :</p>
<ul>
<li>Des objets permettant d'encapsuler / organiser la logique autour de reprÃ©sentation.</li>
<li>De l'hÃ©ritage afin d'organiser le code hiÃ©rarchiquement.</li>
<li>Des interfaces permettant de dÃ©finir un comportement.</li>
</ul>
<p>Les Ã©lÃ©ments de <code>base</code> sont toujours dans un dossier nommÃ© <code>base</code>. Vous retrouverez ce dossier pour les contrÃ´leurs, les routes, les modÃ¨les.</p>
<h3 id="la-configuration" tabindex="-1"><a class="header-anchor" href="#la-configuration" aria-hidden="true">#</a> La configuration</h3>
<p>Avant d'aller plus loin, intÃ©ressons-nous Ã  la configuration. Dans un projet, il est Ã©vident qu'il ne faut pas mettre la configuration n'importe oÃ¹. Vous l'avez vÃ©cu en entreprise, vous avez peut-Ãªtre eu Ã  votre disposition plusieurs serveurs / machines / ordinateurs.</p>
<p>Votre code va fonctionner de maniÃ¨re identique entre chaque environnement, par contre ce qui va certainement changer c'est l'accÃ¨s Ã  la base de donnÃ©es. Cet accÃ¨s, est dÃ©pendant d'une configuration (Utilisateur, Mot de passe, Serveur â€¦) dans une structure MVC on essai de ne pas mettre cette configuration n'importe oÃ¹ !</p>
<p>Dans l'organisation que je vous propose, cette configuration est centralisÃ©e dans le fichier <code>configs.php</code> Ã  la racine du code source.</p>
<div class="custom-container tip"><p class="custom-container-title">La configuration c'est bien !</p>
<p>C'est peut-Ãªtre un dÃ©tail pour vousâ€¦ Mais pour moi Ã§a veut dire beaucoup ! Actuellement vous avez un serveur, mais demain peut-Ãªtre 20â€¦ Et pour votre projet final, vous aurez Ã  dÃ©ployer rapidement votre application sur un autre serveur que celui sur lequel vous avez dÃ©veloppÃ©.</p>
<p>Prenez <strong>dÃ¨s maintenant</strong> l'habitude de mettre votre configuration (IP, Serveur, mot de passe de BDD, etc.) dans le fichier <code>configs.php</code>. Dans l'architecture que je vous propose vous y trouverez le minimum nÃ©cessaire au bon fonctionnement d'une application.</p>
</div>
<h3 id="telecharger-le-code-source" tabindex="-1"><a class="header-anchor" href="#telecharger-le-code-source" aria-hidden="true">#</a> TÃ©lÃ©charger le code source</h3>
<p>Le projet de base est disponible <a href="https://github.com/c4software/mini-mvc-sample/archive/refs/tags/1.4.zip" target="_blank" rel="noopener noreferrer">Ã  l'adresse suivante en cliquant ici<ExternalLinkIcon/></a></p>
<div class="custom-container tip"><p class="custom-container-title">C'est un projet vide</p>
<p>MÃªme si celui-ci contient Ã  premiÃ¨re vue Â« beaucoup de fichiers Â», le projet vous avez tÃ©lÃ©chargÃ© est bien un projet vide.</p>
</div>
<h2 id="faire-fonctionner-le-code" tabindex="-1"><a class="header-anchor" href="#faire-fonctionner-le-code" aria-hidden="true">#</a> Faire fonctionner le code</h2>
<p>La premiÃ¨re Ã©tape est de faire fonctionner le code sur votre machine. Je vous laisse mettre en place le code fourni dans votre dossier <code>htdocs</code> ou <code>www</code> en fonction de l'outil que vous utilisez.</p>
<p><strong>Attention au fichiers cachÃ©s</strong>, dans l'archive il y a un fichier .htaccess ne l'oubliez pas !</p>
<div class="custom-container tip"><p class="custom-container-title">.htaccess ?</p>
<p>Vous avez dÃ©jÃ  entendu parler de ce fichier ? C'est un fichier important, il va nous permettre de dÃ©finir / redÃ©finir le comportement de votre serveur Web pour par exemple activer lâ€™URL REWRITING` (rÃ©Ã©criture d'URL).</p>
<p>La rÃ©Ã©criture d'url va nous permettre d'avoir de beaux liens exemple <code>index.php?page=toto</code> deviendra seulement <code>toto.html</code>. Vous voulez en savoir plus ? Je suis lÃ  ğŸ‘‹, je vais vous donner un complÃ©ment d'information.</p>
</div>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><img src="@source/tp/php/mvc/res/sample.png" alt="Exemple qui fonctionne"></td>
</tr>
<tr>
<td style="text-align:center">Si tout fonctionne correctement, vous devriez avoir ğŸ‘† (superbe n'est-ce pas)</td>
</tr>
</tbody>
</table>
<h2 id="modifier-la-page-Â«-home-Â»" tabindex="-1"><a class="header-anchor" href="#modifier-la-page-Â«-home-Â»" aria-hidden="true">#</a> Modifier la page Â« Home Â»</h2>
<p>Le meilleur moyen pour prendre en main un projet c'est de le modifier, je vous propose donc une premiÃ¨re modification trÃ¨s simple :</p>
<ul>
<li>Modifier la page d'accueil.</li>
</ul>
<p>Je vous propose de mettre en place sur la page d'accueil une photo / image (de votre choix) centrÃ©e via de la CSS.</p>
<div class="custom-container tip"><p class="custom-container-title">C'est Ã  vous</p>
<p>La bonne dÃ©marche Ã  mon sens est lÃ  suivante :</p>
<ul>
<li>Utiliser un IDE pertinent (exemple PHPStorm ou VSCode).</li>
<li>RepensÃ© Ã  l'introduction et la notion de MVC. Nous allons effectivement toucher le <code>Vue</code> (elle mÃªme appelÃ© par le contrÃ´leur), Ã§a veut dire que vous allez trouver votre fichier dans le dossier <code>views</code>.</li>
<li>Pour trouver le bon fichier, je vous laisse un peu investiguer, mais sachez que regarder dans le contrÃ´leur semble Ãªtre une bonne idÃ©eâ€¦</li>
</ul>
<p>ğŸ‘‹ Je suis lÃ  pour ceux qui sont perdus ğŸ¤•</p>
</div>
<h2 id="creer-la-page-Â«-about-Â»" tabindex="-1"><a class="header-anchor" href="#creer-la-page-Â«-about-Â»" aria-hidden="true">#</a> CrÃ©er la page Â« About Â»</h2>
<p>Maintenant que vous avez rÃ©alisÃ© votre modification, je vous propose de regarder Â« Comment ajouter une nouvelle page dans cette superbe architecture (que je trouve dÃ©jÃ  gÃ©niale) Â».</p>
<p>J'imagine que pour l'instant vous avez peur :</p>
<ul>
<li>Mais comment faire pour ajouter une page?</li>
<li>J'ai bien du HTML dans <code>views</code> mais comment je l'appelle?</li>
</ul>
<p>Et bien la rÃ©ponse Ã  vos questions est</p>
<ul>
<li>Une <strong>nouvelle</strong> mÃ©thode dans le bon contrÃ´leur.</li>
<li>Un fichier <code>about.php</code> dans <code>views</code>.</li>
<li>Une correspondance entre Â« Votre mÃ©thode Â» et une route dans le <code>routes/Web.php</code>.</li>
</ul>
<div class="custom-container tip"><p class="custom-container-title">Nous l'avons vu ensemble</p>
<p>Le routeur est un Â« composant Â» trÃ¨s important du web moderne. Il va nous permettre de piloter les ressources accessibles Ã  notre client en les dÃ©clarant dans un fichier.</p>
<ul>
<li>Ã€ votre avis, pourquoi est-ce important de travailler avec une <code>WHITELIST</code> plutÃ´t qu'une <code>BLACKLIST</code> dans ce genre de situation ?</li>
</ul>
</div>
<p>Vu que c'est la premiÃ¨re fois, nous allons le faire ensembleâ€¦ N'hÃ©sitez pas Ã  poser vos questions !</p>
<h3 id="creer-la-methode" tabindex="-1"><a class="header-anchor" href="#creer-la-methode" aria-hidden="true">#</a> CrÃ©er la mÃ©thode</h3>
<p>Nous allons dans un premier temps crÃ©er une mÃ©thode dans le contrÃ´leur <code>SampleWeb.php</code>, pour le contenu pas grand-chose pour l'instant. Vous pouvez vous inspirer du contenu de la mÃ©thode <code>home()</code>.</p>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code><span class="token keyword">function</span> <span class="token function-definition function">about</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Va afficher le header de la page (mais comment ? Avez-vous regardÃ© ?)</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"views/global/about.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">footer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Va afficher le footer de la page (mais comment ? Avez-vous regardÃ© ?)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Pour l'instant aucun changement, si vous utilisez PHPStorm celui-ci va vous proposer de crÃ©er le fichier <code>about.php</code> directement en cliquant sur Â« la petite lampe jaune Â».</p>
<p><img src="@source/tp/php/mvc/res/create_file_phpstorm.png" alt="CrÃ©er le fichier avec PHPStorm"></p>
<h3 id="creer-la-vue-page" tabindex="-1"><a class="header-anchor" href="#creer-la-vue-page" aria-hidden="true">#</a> CrÃ©er la vue / page</h3>
<p>Si ce n'est pas dÃ©jÃ  fait, crÃ©Ã© le fichier <code>views/global/about.php</code>. Pour le contenu, je vous laisse libre. Je vous rappelle juste que nous sommes entrain de crÃ©er une page Â« Ã€ propos Â».</p>
<div class="custom-container tip"><p class="custom-container-title">Rappel</p>
<p>ici nous n'Ã©crivons que le contenu, l'entÃªte et le pied de page sont Â« automatiquement Â» ajoutÃ©s grÃ¢ce au code prÃ©sent dans la mÃ©thode home de votre contrÃ´leur.</p>
</div>
<h3 id="creer-la-route" tabindex="-1"><a class="header-anchor" href="#creer-la-route" aria-hidden="true">#</a> CrÃ©er la route</h3>
<p>VoilÃ  nous avons maintenant l'ensemble du code, mais celui-ci n'est pas encore accessible. Pour le rendre accessible, vous devez le dÃ©clarer dans le routeur.</p>
<p>Ici nous sommes entrain de faire une page <code>Web</code>, vous devez donc ajouter dans le routeur <code>Web.php</code> l'accÃ¨s Ã  votre page via l'ajout de la ligne suivante :</p>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code><span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/about'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$main</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'about'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul>
<li><strong>Ã‰videmment</strong> c'est Ã  ajouter aprÃ¨s la route existante.</li>
<li>Le premier paramÃ¨tre correspond au Â« Chemin / lien d'accÃ¨s Â», le second Ã©tant la mÃ©thode Ã  appeler dans le bon contrÃ´leur.</li>
</ul>
<p>ğŸ‘‹ Je vous laisse tester l'accÃ¨s Ã  votre page</p>
<h2 id="place-au-projet-Â«-la-todo-list-Â»" tabindex="-1"><a class="header-anchor" href="#place-au-projet-Â«-la-todo-list-Â»" aria-hidden="true">#</a> Place au projet Â« La TODO list Â»</h2>
<p>Maintenant que nous avons pris en main le code existant, je vous propose de rÃ©aliser une plus grosse modification, l'ajout d'une nouvelle fonctionnalitÃ© Â« La TodoList Â», pour rÃ©aliser l'ensemble du code, je vais bien Ã©videmment vous guider.</p>
<p>Nous allons donc crÃ©er une TODO List. Une TODO List c'est toujours le mÃªme genre d'action :</p>
<ul>
<li>Une Liste.</li>
<li>Un ajout dans la liste.</li>
<li>Un marquÃ© comme terminer Â« une todo Â».</li>
<li>Un supprimÃ© qui supprime uniquement les taches Â« avec comme statut, termine = 1 Â».</li>
</ul>
<p>Nous allons donc avoir 4 fonctionnalitÃ©s dans notre application. Chaque fonctionnalitÃ© je le rappelle sera une mÃ©thode de notre contrÃ´leur :</p>
<table>
<thead>
<tr>
<th style="text-align:center">Route</th>
<th style="text-align:right">MÃ©thode dans le contrÃ´leur</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>/list</code></td>
<td style="text-align:right"><code>liste()</code></td>
</tr>
<tr>
<td style="text-align:center"><code>/ajouter</code></td>
<td style="text-align:right"><code>ajouter($texte)</code></td>
</tr>
<tr>
<td style="text-align:center"><code>/terminer</code></td>
<td style="text-align:right"><code>terminer($id)</code></td>
</tr>
<tr>
<td style="text-align:center"><code>/supprimer</code></td>
<td style="text-align:right"><code>supprimer($id)</code></td>
</tr>
</tbody>
</table>
<p>L'Ã©tape de dÃ©finition des diffÃ©rentes actions est <strong>primordiale</strong>, Ã§a va nous permettre de crÃ©er notre objet de maniÃ¨re efficace, l'autre bonne faÃ§on de reprÃ©senter notre objet est via une modÃ©lisation UML.</p>
<p><img src="@source/tp/php/mvc/res/todoControler.png" alt="ModÃ©lisation UML"></p>
<div class="custom-container tip"><p class="custom-container-title">Vous vous intÃ©grez dans un framework</p>
<p>Parlons un peu de la modÃ©lisation UML que je vous propose, comme vous pouvez le constater nous avons ici la dÃ©finition de la class avec les diffÃ©rentes mÃ©thodes dÃ©finies dans le tableau.</p>
<p>Nous avons Ã©galement une classe en plus ; cette classe est Â« la base Â» d'un contrÃ´leur, elle dÃ©finit les mÃ©thodes de bases communes Ã  l'ensemble des contrÃ´leurs du framework.</p>
<p>ğŸ—£ Cette classe ne sera <strong>jamais</strong> instanciÃ©e directement, la flÃ¨che Â« extends Â» dÃ©fini la notion d'hÃ©ritage.</p>
</div>
<h3 id="bootstrap" tabindex="-1"><a class="header-anchor" href="#bootstrap" aria-hidden="true">#</a> Bootstrap</h3>
<p>Nous allons utiliser Bootstrap pour coder l'interface, n'hÃ©sitez donc pas Ã  consulter la documentation :</p>
<ul>
<li><a href="https://getbootstrap.com/docs/5.0/getting-started/introduction/" target="_blank" rel="noopener noreferrer">Bootstrap<ExternalLinkIcon/></a></li>
<li><a href="https://icons.getbootstrap.com/" target="_blank" rel="noopener noreferrer">Bootstrap Icon<ExternalLinkIcon/></a></li>
</ul>
<h3 id="modelisation-de-la-base-de-donnees" tabindex="-1"><a class="header-anchor" href="#modelisation-de-la-base-de-donnees" aria-hidden="true">#</a> ModÃ©lisation de la base de donnÃ©es</h3>
<p>Avant de continuer, je vous propose de dÃ©finir le format de la base de donnÃ©es. En effet, notre modÃ¨le reposera sur celle-ci il faut donc rÃ©flÃ©chir Ã  celle-ci. L'idÃ©e ici est de faire du code, j'ai donc rÃ©flÃ©chi (un peu) Ã  votre place. Le minimum pour que nous puissions rÃ©aliser notre Â« TodoList Â» est la crÃ©ation de la table suivante :</p>
<p><img src="@source/tp/php/mvc/res/todos.png" alt="ModÃ©lisation table TODO"></p>
<p>PS: Oui, oui je sais c'est impressionnant !</p>
<h3 id="creer-le-modele" tabindex="-1"><a class="header-anchor" href="#creer-le-modele" aria-hidden="true">#</a> CrÃ©er le modÃ¨le</h3>
<p>Le modÃ¨le va Ãªtre le moyen d'accÃ©der Ã  nos donnÃ©es, c'est ici que nous allons Ã©crire nos requÃªtes SQL (<strong>et uniquement ici</strong>). Utiliser un framework signifie en gÃ©nÃ©ral gagner du temps ! Pour l'instant, j'imagine que vous n'en avez pas l'impression, mais je vous assure quand vous maitrisez un framework et/ou une architecture vous gagnerez un temps fou. Ce gain de temps vient de deux Ã©lÃ©ments :</p>
<ul>
<li>L'architecture des dossiers et du code propre et bien organisÃ©.</li>
<li>Des outils pour crÃ©er les diffÃ©rents Ã©lÃ©ments.</li>
<li>Du code partagÃ©, utilisÃ© sans copier / collÃ©.</li>
</ul>
<p>Le framework que je vous propose entre directement dans cette catÃ©gorie Â« Gagner du temps Â». Pour crÃ©er notre modÃ¨le au lieu de copier / coller du code vous avez de base (intÃ©grer dans le code) un outil en ligne de commande qui s'occupe de tout (si si). Pour crÃ©er votre modÃ¨le pour accÃ©der au TodoList il vous suffit de :</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token comment"># Hors Windows</span>
php index.php model:create TodoModel

<span class="token comment"># Sous Windows (avec XAMPP)</span>
C:/xampp/php/php index.php model:create TodoModel

<span class="token comment"># Sous Windows (avec WAMP)</span>
C:/wamp64/bin/php/php7.4.9/php index.php model:create TodoModel
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>Et c'est tout !</strong> votre modÃ¨le pour accÃ©der aux donnÃ©es est prÃªt ğŸ¤. Nous avons maintenant une classe qui nous permettra d'accÃ©der aux donnÃ©es contenues dans la base de donnÃ©es. L'accÃ¨s aux donnÃ©es se fera :</p>
<ul>
<li>Via les mÃ©thodes Â« de base Â» (comme vu en cours via l'hÃ©ritage prÃ©sent dans la classe).</li>
<li>Via <strong><em>vos mÃ©thodes</em></strong> directement Ã©crite par vous.</li>
</ul>
<div class="custom-container tip"><p class="custom-container-title">Pas de magie (jamais)</p>
<p>Je vous invite Ã  regarder comment fonctionne cette partie dans le code. Ce nâ€™est pas bien compliquÃ©. D'ailleurs, regardons ensemble !</p>
</div>
<div class="custom-container warning"><p class="custom-container-title">Vous avez du mal Ã  voir ce que nous avons crÃ©Ã© non ?</p>
<p>Et oui, les commandes magiques c'est bien â€¦ mais voilÃ  ce que nous avons crÃ©Ã© :</p>
<p><img src="@source/tp/php/mvc/res/umlTodoModel.jpg" alt="TodoModel"></p>
<ul>
<li>SQL est Â« une classe de base Â», elle est intÃ©grÃ©e dans le framework.</li>
<li>Votre classe <code>TodoModel</code> hÃ©rite de la classe SQL. (Vous pouvez m'en dire plus ?)</li>
<li>Votre classe <code>TodoModel</code> a Ã©tÃ© crÃ©Ã©e dans le dossier <code>models</code>. (Je vous laisse aller regarder)</li>
<li>Pourquoi notre classe ne possÃ¨de-t-elle qu'une seule mÃ©thode ?</li>
</ul>
</div>
<h3 id="modifier-le-constructeur" tabindex="-1"><a class="header-anchor" href="#modifier-le-constructeur" aria-hidden="true">#</a> Modifier le constructeur</h3>
<p>Dans le constructeur de la classe, je vous laisse modifier les paramÃ¨tres lors de la crÃ©ation du parent ; afin de spÃ©cifier le bon tableName et primmaryKey.</p>
<p>Je vous redonne le schÃ©ma de la base de donnÃ©es :</p>
<p><img src="@source/tp/php/mvc/res/todos.png" alt="ModÃ©lisation table TODO"></p>
<h3 id="creer-la-methode-Â«-marquercommetermine-Â»" tabindex="-1"><a class="header-anchor" href="#creer-la-methode-Â«-marquercommetermine-Â»" aria-hidden="true">#</a> CrÃ©er la mÃ©thode Â« marquerCommeTermine() Â»</h3>
<p>Dans le diagramme UML j'indique la prÃ©sence d'une mÃ©thode <code>marquerCommeTermine()</code>, si vous avez ouvert la classe crÃ©Ã©e vous allez voir que cette mÃ©thode n'est pas prÃ©sente. Nous allons donc devoir la crÃ©erâ€¦</p>
<ul>
<li>Pourquoi la mÃ©thode n'est pas prÃ©sente ?</li>
<li>Pourquoi ne pas utiliser les mÃ©thodes fournies par le parent ?</li>
</ul>
<p>Cette mÃ©thode doit marquer comme terminÃ© un enregistrement en base de donnÃ©es, nous allons donc avoir besoin</p>
<ul>
<li>D'un <code>id</code> en paramÃ¨tre de la mÃ©thode.</li>
<li>D'une requÃªte d'update.</li>
<li>D'un connecteur PDO (pour parler Ã  la base de donnÃ©es)</li>
</ul>
<p>Vu que c'est la premiÃ¨re fois je vous donne du code, mais attention Ã  bien comprendre ce que vous copiÃ©/collÃ© :</p>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code><span class="token keyword">function</span> <span class="token function-definition function">marquerCommeTermine</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">pdo</span><span class="token operator">-></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"UPDATE todos SET termine = 1 WHERE id = ?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$id</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><details class="custom-container details"><summary>Besoin d'aide ?</summary>
<p>Votre classe doit maintenant ressembler Ã </p>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">namespace</span> <span class="token package">models</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">models<span class="token punctuation">\</span>base<span class="token punctuation">\</span>SQL</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">TodoModel</span> <span class="token keyword">extends</span> <span class="token class-name">SQL</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'todos'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function-definition function">todoNonTermine</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">pdo</span><span class="token operator">-></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"SELECT * FROM todos WHERE termine = 0;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">fetchAll</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>PDO</span><span class="token operator">::</span><span class="token constant">FETCH_ASSOC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function-definition function">marquerCommeTermine</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">pdo</span><span class="token operator">-></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"UPDATE todos SET termine = 1 WHERE id = ?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$stmt</span><span class="token operator">-></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$id</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div></details>
<p>Questions :</p>
<ul>
<li>Ã€ votre avis est-ce la seule faÃ§on de faire ?</li>
<li>Avons-nous toutes les mÃ©thodes nÃ©cessaires pour rÃ©aliser notre application ?</li>
</ul>
<h3 id="initialiser-la-base-de-donnees" tabindex="-1"><a class="header-anchor" href="#initialiser-la-base-de-donnees" aria-hidden="true">#</a> Initialiser la base de donnÃ©es</h3>
<p>Votre projet avance petit Ã  petit, nous avons dÃ©jÃ  crÃ©Ã© :</p>
<ul>
<li>La base du projet (structure).</li>
<li>Le modÃ¨le pour accÃ©der aux donnÃ©es.</li>
<li>Les mÃ©thodes permettant de modifier les donnÃ©es.</li>
</ul>
<p>C'est dÃ©jÃ  pas mal, mais il manque maintenant la base de donnÃ©es en elle-mÃªme. Dans un framework cette partie-lÃ  est Ã©galement automatisable (vous verrez avec Laravel c'est encore plus puissant). Dans un framework appliquÃ© les modifications dans la base de donnÃ©es s'appellent rÃ©aliser une Â« migration Â», avec notre Â« mini framework Â» pour crÃ©er la base de donnÃ©es il suffit de crÃ©er <strong>un fichier</strong> dans le dossier <code>migrations</code> :</p>
<ul>
<li>CrÃ©er le fichier <code>init.sql</code> dans le dossier Migration, y mettre le contenu suivant :</li>
</ul>
<div class="language-sql ext-sql line-numbers-mode"><pre v-pre class="language-sql"><code><span class="token comment">--</span>
<span class="token comment">-- Structure de la table `todos`</span>
<span class="token comment">--</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>todos<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>texte<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>termine<span class="token punctuation">`</span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span><span class="token keyword">timestamp</span><span class="token punctuation">`</span> <span class="token keyword">timestamp</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">current_timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span>

<span class="token comment">--</span>
<span class="token comment">-- Index pour les tables dÃ©chargÃ©es</span>
<span class="token comment">--</span>

<span class="token comment">--</span>
<span class="token comment">-- Index pour la table `todos`</span>
<span class="token comment">--</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>todos<span class="token punctuation">`</span>
  <span class="token keyword">ADD</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">--</span>
<span class="token comment">-- AUTO_INCREMENT pour les tables dÃ©chargÃ©es</span>
<span class="token comment">--</span>

<span class="token comment">--</span>
<span class="token comment">-- AUTO_INCREMENT pour la table `todos`</span>
<span class="token comment">--</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>todos<span class="token punctuation">`</span>
  <span class="token keyword">MODIFY</span> <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><ul>
<li>Installer la migration (appliquer les modifications sur votre base de donnÃ©es) via la commande :</li>
</ul>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token comment"># Hors Windows</span>
php index.php db:migrate

<span class="token comment"># Sous Windows (avec XAMPP)</span>
C:/xampp/php/php index.php db:migrate

<span class="token comment"># Sous Windows (avec WAMP)</span>
C:/wamp64/bin/php/php7.4.9/php index.php db:migrate
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Si tout va bien vous devriez avoir le rÃ©sultat suivant:</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token operator">=</span><span class="token operator">></span> Start migration of Â« migrations/init.sql Â»
<span class="token operator">=</span><span class="token operator">></span> End migration of Â« migrations/init.sql Â»
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="custom-container tip"><p class="custom-container-title">Point d'avancement</p>
<ul>
<li>Ã‡a ne fonctionne pas ? Avez-vous vÃ©rifiÃ© si vous avez configurÃ© votre projet (<code>configs.php</code>).</li>
<li>VÃ©rifier si la base a bien Ã©tÃ© crÃ©Ã©e dans votre PhpMyAdmin / DataGrip ğŸ‘Œ</li>
<li>Mais c'est gÃ©nial !</li>
</ul>
<iframe src="https://giphy.com/embed/SACoDGYTvVNhZYNb5a" width="480" height="360" frameBorder="0" class="giphy-embed" allowFullScreen></iframe>
</div>
<h3 id="creer-le-controleur" tabindex="-1"><a class="header-anchor" href="#creer-le-controleur" aria-hidden="true">#</a> CrÃ©er le contrÃ´leur</h3>
<p>Notre base est prÃªteâ€¦ Et si nous Ã©crivions vraiment le code ? Comme pour crÃ©er le modÃ¨le, le framework vous fait gagner du temps ! Ici aussi pas besoin de copier / coller du code, une simple ligne de commande va vous initialiser un ContrÃ´leur Â« vide Â» :</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token comment"># Hors Windows</span>
php index.php controller:create TodoWeb

<span class="token comment"># Sous Windows (avec XAMPP)</span>
C:/xampp/php/php index.php controller:create TodoWeb

<span class="token comment"># Sous Windows (avec WAMP)</span>
C:/wamp64/bin/php/php7.4.9/php index.php controller:create TodoWeb
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Cette commande va initialiser un contrÃ´leur de type Web. Celui-ci est pour l'instant vide de mÃ©thode :</p>
<p><img src="@source/tp/php/mvc/res/todoControler.png" alt="ModÃ©lisation UML"></p>
<p>Ce contrÃ´leur est pour l'instant vide, nous allons dans un premier temps devoir lui crÃ©er un constructeur afin de crÃ©er le modÃ¨le permettant l'accÃ¨s Ã  la base de donnÃ©es.</p>
<h3 id="definir-les-routes-dans-le-routeur" tabindex="-1"><a class="header-anchor" href="#definir-les-routes-dans-le-routeur" aria-hidden="true">#</a> DÃ©finir les routes dans le routeur</h3>
<p>Vous vous souvenez lors de la crÃ©ation de notre premiÃ¨re page, nous avions dÃ» ajouter une ligne dans le routeur afin de rendre accessibles les mÃ©thodes. Pour notre nouveau contrÃ´leur, Ã§a sera la mÃªme chose !</p>
<table>
<thead>
<tr>
<th style="text-align:center">Routes</th>
<th style="text-align:center">ContrÃ´leur</th>
<th style="text-align:center">MÃ©thodes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">/todo/liste</td>
<td style="text-align:center"><code>TodoWeb</code></td>
<td style="text-align:center"><code>liste()</code></td>
</tr>
<tr>
<td style="text-align:center">/todo/ajouter</td>
<td style="text-align:center"><code>TodoWeb</code></td>
<td style="text-align:center"><code>ajouter()</code></td>
</tr>
<tr>
<td style="text-align:center">/todo/terminer</td>
<td style="text-align:center"><code>TodoWeb</code></td>
<td style="text-align:center"><code>terminer()</code></td>
</tr>
<tr>
<td style="text-align:center">/todo/supprimer</td>
<td style="text-align:center"><code>TodoWeb</code></td>
<td style="text-align:center"><code>supprimer()</code></td>
</tr>
</tbody>
</table>
<p>Dans le fichier <code>routes/Web.php</code>, ajouter le lignes :</p>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code>  <span class="token variable">$todo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TodoWeb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/todo/liste'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$todo</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'liste'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/todo/ajouter'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$todo</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ajouter'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/todo/terminer'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$todo</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'terminer'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/todo/supprimer'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$todo</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'supprimer'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul>
<li>OÃ¹ les ajouter ?</li>
<li>Ã€ quoi correspondent-t-elles ?</li>
</ul>
<h3 id="ajouter-le-constructeur-construct" tabindex="-1"><a class="header-anchor" href="#ajouter-le-constructeur-construct" aria-hidden="true">#</a> Ajouter le constructeur <code>__construct()</code></h3>
<p>Le contrÃ´leur aura pour but d'aller rÃ©cupÃ©rer les Todo en base <strong>via</strong> le modÃ¨le. Il faut donc donner un accÃ¨s au modÃ¨le depuis la classe. Nous allons donc Ã©crire <strong>le constructeur</strong> de la mÃ©thode. En PHP, le constructeur s'Ã©crit :</p>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code>    <span class="token keyword">private</span> <span class="token variable">$todoModel</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">todoModel</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TodoModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Je vous laisse rÃ©flÃ©chir sur l'endroit ou mettre le code en question.</p>
<details class="custom-container details"><summary>Voir une solution</summary>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">namespace</span> <span class="token package">controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">controllers<span class="token punctuation">\</span>base<span class="token punctuation">\</span>Web</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">models<span class="token punctuation">\</span>TodoModel</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">TodoWeb</span> <span class="token keyword">extends</span> <span class="token class-name">Web</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$todoModel</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">todoModel</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TodoModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></details>
<h3 id="la-methode-liste" tabindex="-1"><a class="header-anchor" href="#la-methode-liste" aria-hidden="true">#</a> La mÃ©thode <code>liste()</code></h3>
<p>La premiÃ¨re mÃ©thode que nous allons crÃ©er est celle de la liste. Elle se nommera <code>liste()</code>, cette mÃ©thode sera automatiquement appelÃ©e via le <code>routeur</code> Ã  <strong>chaque visite d'un utilisateur</strong>. L'objectif de cette mÃ©thode est :</p>
<ul>
<li>Afficher le header de la page (<code>$this-&gt;header()</code> mÃ©thode hÃ©ritÃ©e du parent).</li>
<li>RÃ©cupÃ©rer l'ensemble des TODO (Array) actuellement en base via la mÃ©thode <code>getAll()</code> du TodoModel modÃ¨le.</li>
<li>Afficher votre <code>vue</code> via un include.</li>
<li>Afficher le footer de la page (<code>$this-&gt;footer()</code> mÃ©thode hÃ©ritÃ©e du parent).</li>
</ul>
<div class="custom-container tip"><p class="custom-container-title">Toujours la mÃªme forme</p>
<p>Vous allez rapidement vous apercevoir que la structure de base est toujours la mÃªme. Nous allons toujours faire la mÃªme chose lors de la crÃ©ation d'une mÃ©thode dans un contrÃ´leur Ã  savoir :</p>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code>    <span class="token keyword">function</span> <span class="token function-definition function">maMethodeQueJaiCopierColler</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Pourquoi j'ai copier / coller ceci ? C'est un exemple seulement</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"views/global/home.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">footer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>Pssst</strong>, ne copier / coller pas le code prÃ©cÃ©dent !! C'est un simple exemple.</p>
</div>
<p>Dans notre cas, la mÃ©thode va ressembler Ã  :</p>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code><span class="token keyword">function</span> <span class="token function-definition function">liste</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Affichage de l'entÃªte.</span>
        <span class="token variable">$todos</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">todoModel</span><span class="token operator">-></span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// RÃ©cupÃ©ration des TODOS prÃ©sents en base.</span>
        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"views/todos/liste.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Affichage de votre vue.</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">footer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Affichage de votre pied de page.</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Et c'est tout ! La puissance d'un Frawerork c'est aussi Ã§a, Ã©crire finalement pas Ã©normÃ©ment de ligne pour afficher une page. Pourtant cette page :</p>
<ul>
<li>Affiche une entÃªte.</li>
<li>RÃ©cupÃ¨re en base de donnÃ©es les Ã©lÃ©ments.</li>
<li>Affiche la page.</li>
<li>Affiche le pied de page.</li>
</ul>
<h3 id="le-template-de-la-page-liste" tabindex="-1"><a class="header-anchor" href="#le-template-de-la-page-liste" aria-hidden="true">#</a> Le template de la page liste</h3>
<p>Votre IDE doit actuellement Ãªtre moyen contentâ€¦ Effectivement, nous avons fait un <code>include</code> de <code>&quot;views/todos/liste.php&quot;</code> pourtant ce fichier n'existe pas.</p>
<p>Vu qu'il s'agit ici d'un projet dÃ©couvert, je vais vous en donner le contenu (si vous le souhaitez, vous pouvez Ã©galement l'Ã©crire) voilÃ  le rendu :</p>
<p><img src="@source/tp/php/mvc/res/todoPreview.png" alt="Interface TODO"></p>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container p-3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>card<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>card-body p-2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token comment">&lt;!-- Action --></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./ajouter<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>add<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>input-group<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>texte<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>texte<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Prendre une noteâ€¦<span class="token punctuation">"</span></span> <span class="token attr-name">aria-label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>My new idea<span class="token punctuation">"</span></span> <span class="token attr-name">aria-describedby</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>basic-addon1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>

            <span class="token comment">&lt;!-- Liste --></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list-group pt-3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
                <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$todos</span> <span class="token keyword">as</span> <span class="token variable">$todo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token delimiter important">?></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list-group-item<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>d-flex<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>flex-grow-1 align-self-center<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?=</span> <span class="token variable">$todo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'texte'</span><span class="token punctuation">]</span> <span class="token delimiter important">?></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./terminer?id=<span class="token php language-php"><span class="token delimiter important">&lt;?=</span> <span class="token variable">$todo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span> <span class="token delimiter important">?></span></span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-outline-success<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bi bi-check<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
                                <span class="token comment">&lt;!-- Action Ã  ajouter pour Supprimer --></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
                    <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token variable">$todos</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token delimiter important">?></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list-group-item text-center<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>C'est vide !<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
                    <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
                <span class="token punctuation">}</span>
                <span class="token delimiter important">?></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>Je vous laisse mettre le contenu dans votre fichier <code>views/todos/liste.php</code>.</p>
<div class="custom-container tip"><p class="custom-container-title">Valider le bon fonctionnement</p>
<p>Si vous accÃ©dez Ã  votre page <code>todo/liste</code> vous devriez avoir le contenu suivant :</p>
<p><img src="@source/tp/php/mvc/res/todo_resultat_liste.png" alt="RÃ©sultat Liste vide"></p>
</div>
<h3 id="la-methode-ajouter-texte" tabindex="-1"><a class="header-anchor" href="#la-methode-ajouter-texte" aria-hidden="true">#</a> La mÃ©thode <code>ajouter($texte = '')</code></h3>
<p>Cette mÃ©thode sera automatiquement appelÃ© quand vous aller appuyer sur la touche <key>Entrer</key> de votre clavier dans le champ de saisie sur la page <code>Liste</code>. L'objectif de cette mÃ©thode est de traiter l'action Â« J'ajoute un nouvel enregistrement dans la base Todo Â».</p>
<p>Pour le code, je vais vous aider un peu, voilÃ  le code du contrÃ´leur :</p>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code><span class="token keyword">function</span> <span class="token function-definition function">ajouter</span><span class="token punctuation">(</span><span class="token variable">$texte</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">todoModel</span><span class="token operator">-></span><span class="token function">ajouterTodo</span><span class="token punctuation">(</span><span class="token variable">$texte</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"./liste"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul>
<li>Ã€ quoi correspond la mÃ©thode <code>redirect(â€¦)</code> ? D'oÃ¹ provient-elle ?</li>
</ul>
<p><em>C'est Ã  vous :</em></p>
<ul>
<li>Mettre en place le code dans le contrÃ´leur.</li>
<li>Ã‰crire la mÃ©thode ajouterTodo dans le modÃ¨le <code>TodoModel</code> (n'oubliez pas l'autocomplÃ©tion).
<ul>
<li>Ã‰crire la requÃªte <code>INSERT â€¦</code></li>
</ul>
</li>
<li>Tester le bon fonctionnement</li>
</ul>
<p>Dans mon cas voilÃ  le rÃ©sultat :</p>
<p><img src="@source/tp/php/mvc/res/todo_resultat_ajouter.png" alt="RÃ©sultat Liste vide"></p>
<h4 id="ajouter-une-validation" tabindex="-1"><a class="header-anchor" href="#ajouter-une-validation" aria-hidden="true">#</a> Ajouter une validation</h4>
<p>Actuellement dans le code que vous avez copiÃ© il est possible d'ajouter des Â« TODO Â» sans texte. Je vous propose donc d'ajouter un contrÃ´le de saisie <strong>dans le PHP</strong>.</p>
<p>Le contrÃ´le doit empÃªcher l'ajoute d'une TODO si <code>$texte == ''</code>.</p>
<ul>
<li>OÃ¹ placez-vous le contrÃ´le ?</li>
<li>Pourquoi ?</li>
</ul>
<h3 id="la-methode-terminer-id" tabindex="-1"><a class="header-anchor" href="#la-methode-terminer-id" aria-hidden="true">#</a> La mÃ©thode <code>terminer($id = '')</code></h3>
<p>Vous l'avez comprisâ€¦ Je vous donne de moins en moins de code ! La mÃ©thode <code>terminer</code> sera trÃ¨s proche de <code>ajouter</code> sauf que celle-ci va prendre en paramÃ¨tre l'id de l'Ã©lÃ©ment Ã  marquer comme terminÃ© :</p>
<div class="language-php ext-php line-numbers-mode"><pre v-pre class="language-php"><code><span class="token keyword">function</span> <span class="token function-definition function">terminer</span><span class="token punctuation">(</span><span class="token variable">$id</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$id</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">todoModel</span><span class="token operator">-></span><span class="token function">marquerCommeTermine</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"./liste"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul>
<li>D'oÃ¹ arrive le paramÃ¨tre <code>$id</code> ?</li>
<li>Pourquoi est-ce automatique ?</li>
</ul>
<p><em>Ã€ faire</em> :</p>
<ul>
<li>Mettre en place le code, valider le bon fonctionnement avec <strong>PHPMyAdmin</strong></li>
<li>Modifier la vue pour afficher le bouton vert <strong>seulement si</strong> la tÃ¢che est non terminÃ©e</li>
<li>Ajouter un bouton supprimÃ© visible <strong>uniquement si</strong> la tÃ¢che est terminÃ©e</li>
</ul>
<p><img src="@source/tp/php/mvc/res/todo_resultat_terminer.png" alt="RÃ©sultat Liste vide"></p>
<h3 id="la-methode-supprimer-id" tabindex="-1"><a class="header-anchor" href="#la-methode-supprimer-id" aria-hidden="true">#</a> La mÃ©thode <code>supprimer($id = '')</code></h3>
<p>En utilisant le code prÃ©cÃ©demment fourni, Ã©crire :</p>
<ul>
<li>La mÃ©thode dans le modÃ¨le permettant de supprimer un Ã©lÃ©ment dans la base de donnÃ©es pour un id donnÃ©.</li>
<li>La mÃ©thode dans le contrÃ´leur permettant de traiter l'action.</li>
<li><strong>Ne permettre la suppression</strong> que des Todo ayant <code>termine = 1</code>. La vÃ©rification <strong>ne doit pas Ãªtre</strong> prÃ©sente que dans la vue.</li>
</ul>
<p>C'est Ã  vous.</p>
<h3 id="un-serveur-de-dev" tabindex="-1"><a class="header-anchor" href="#un-serveur-de-dev" aria-hidden="true">#</a> Un serveur de dev ?</h3>
<p>Si vous souhaitez tester votre code sans dÃ©marrer XAMPP c'est possible. PHP intÃ¨gre un serveur Web de Â« dÃ©veloppement Â», pour le lancer il suffit de :</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token comment"># Windows (avec XAMPP)</span>
C:/xampp/php/php -S localhost:9000

<span class="token comment"># Windows (avec WAMP)</span>
C:/wamp64/bin/php/php7.4.9/php -S localhost:9000

<span class="token comment"># Linux / OSX</span>
php -S localhost:9000
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="evolution-0" tabindex="-1"><a class="header-anchor" href="#evolution-0" aria-hidden="true">#</a> Ã‰volution 0</h3>
<p>Ajouter dans la page d'accueil du site un lien permettant d'accÃ©der Ã  votre TodoList. Quelques consignes Ã  respecter :</p>
<ul>
<li>Le lien doit Ãªtre centrÃ© dans la page.</li>
<li>Le lien doit avoir l'<strong>apparence</strong> d'un bouton. <a href="https://getbootstrap.com/docs/5.0/components/buttons/" target="_blank" rel="noopener noreferrer">Voir la documentation<ExternalLinkIcon/></a></li>
</ul>
<h3 id="evolution-1" tabindex="-1"><a class="header-anchor" href="#evolution-1" aria-hidden="true">#</a> Ã‰volution 1</h3>
<p>Je souhaite finalement masquer de l'affichage par dÃ©faut l'ensemble des enregistrements de la table <code>TODO</code> ayant <code>termine = 1</code>.</p>
<p>Je vous laisse modifier :</p>
<ul>
<li>Le code du modÃ¨le afin d'y ajouter une mÃ©thode.</li>
<li>Appeler cette mÃ©thode depuis votre page Ã  la place du <code>getAll()</code>.</li>
</ul>
<h3 id="evolution-2" tabindex="-1"><a class="header-anchor" href="#evolution-2" aria-hidden="true">#</a> Ã‰volution 2</h3>
<p>La partie TODOList ne doit pas Ãªtre accessible Ã  tous. En utilisant les techniques vu avec la SESSION (<code>$_SESSION</code>) ainsi qu'en rÃ©flÃ©chissant sur les impacts en termes de sÃ©curitÃ© (protection dans le routeur par exemple). Limiter l'accÃ¨s de la partie TODOList seulement aux personnes avec un compte sur la plateforme.</p>
<ul>
<li>Quels impacts sont Ã  prÃ©voir dans le routeur ?</li>
<li>Est-ce nÃ©cessaire de crÃ©er un nouveau modÃ¨le ?</li>
<li>Est-ce nÃ©cessaire de crÃ©er un nouveau contrÃ´leur ?</li>
<li>Combien de vue sera(ont) nÃ©cessaire(s) en plus de celles existantes ?</li>
</ul>
<h3 id="evolution-3" tabindex="-1"><a class="header-anchor" href="#evolution-3" aria-hidden="true">#</a> Ã‰volution 3</h3>
<p>Maintenant que nous avons un systÃ¨me d'authentification, je vous propose de sauvegarder qui a crÃ©Ã© la TODO pour ce faire :</p>
<ul>
<li>Modifier la base de donnÃ©es afin d'ajouter Â« l'email / nom d'utilisateur Â» de la personne ayant crÃ©Ã© la TODO</li>
<li>Modifier la mÃ©thode d'ajout dans le modÃ¨le pour enregistrer l'information
<ul>
<li>Attention, comment allez-vous procÃ©der pour rÃ©cupÃ©rer la personne actuellement connectÃ©e ?</li>
</ul>
</li>
<li>Ajouter <strong>dans la vue</strong>, l'affichage de l'identitÃ© de la personne.
<ul>
<li>IdÃ©alement en groupant les TODO par nom d'utilisateur / email.</li>
</ul>
</li>
</ul>
<h3 id="evolution-4" tabindex="-1"><a class="header-anchor" href="#evolution-4" aria-hidden="true">#</a> Ã‰volution 4</h3>
<p>Modifier la page d'accueil de votre site afin que celle-ci prÃ©sente votre projet.</p>
</template>
